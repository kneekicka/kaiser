window.Registry=function(){"use strict";function e(e){return!(!e.getInstance||"function"!=typeof e.getInstance)}function n(n,t){if(!e(t))throw new Error('Invalide module "'+n+'". The function "getInstance" is not defined.');c[n]=t}function t(n){for(var t in n)if(n.hasOwnProperty(t)){if(!e(n[t]))throw new Error('Invalide module "'+t+'" inside the collection. The function "getInstance" is not defined.');c[t]=n[t]}}function r(e){delete c[e]}function i(e){var n=c[e];if(!n)throw new Error('The module "'+e+'" has not been registered or it was unregistered.');if("function"!=typeof n.getInstance)throw new Error('The module "'+e+'" can not be instantiated. The function "getInstance" is not defined.');return c[e].getInstance()}function o(){return f}function u(e){return f=e}var c={},f="grid";return{register:n,unregister:r,_get:i,registryMap:t,getMode:o,setMode:u}}();
Registry.register("accordion",function(n){"use strict";function t(){return{init:function(){n(".accordion").each(function(){s.accordion(n(this))})},accordion:function(t){t.settings=s.populateOptions(t),s.hideAccordionContent(t),n("."+t.settings.triggerClass+" a",t).on("click.accordion",s.onClick.bind(this,t))},onClick:function(t,s){s.preventDefault(),n("."+t.settings.contentClass,t).slideToggle(),n("."+t.settings.contentClass,t).toggleClass(t.settings.contentOpenClass),n(s.currentTarget).toggleClass(t.settings.openClass)},hideAccordionContent:function(t){n("."+t.settings.triggerClass+" a",t).each(function(){var s=n(this),e=n("."+t.settings.contentClass,t);s.hasClass(t.settings.openClass)?e.addClass(t.settings.contentOpenClass).slideDown():e.removeClass(t.settings.contentOpenClass).slideUp()})},populateOptions:function(n){return{contentClass:n.data("accordion-content-class")||"accordion-content",contentOpenClass:n.data("accordion-content-open-class")||"content-open",openClass:n.data("accordion-open-class")||"open",speed:n.data("accordion-speed")||300,triggerClass:n.data("accordion-trigger-class")||"accordion-trigger"}}}}var s;return{getInstance:function(){return s||(s=t()),s}}}(jQuery));
Registry.register("common",function(n){"use strict";function e(){return{nonceAjax:!1,prependArr:function(n,e){var t=e.slice(0);return t.unshift(n),t},getPage:function(){return!_.isUndefined(t.parseRequest().page)&&t.parseRequest().page},parseRequest:function(e){var t,o=location.search,i={};return _.isEmpty(o)||"?"===o?i:(o=o.replace("?",""),t=o.split("&"),n.each(t,function(){var n=this;n=n.split("="),i[n[0]]=n[1]}),_.isUndefined(e)?i:i[e])},loadFolders:function(e,o){var i={controller:"folder"};n.extend(i,e),t.wpAjax(i,function(n){!_.isUndefined(o)&&_.isFunction(o)&&o(n)},function(n){console&&console.warn(n)})},loadImages:function(e,o){var i={controller:"media",action:"content",count:0,step:40};n.extend(i,e),t.wpAjax(i,function(n){!_.isUndefined(o)&&_.isFunction(o)&&o(n)},function(n){console&&console.warn(n)})},wpAjax:function(n,e,t){var o=!0,i=window.tm_pg_options.action;n[i]=n.action,n.tm_pg_nonce=window.tm_pg_options.nonce,o&&wp.ajax.send("tm_pg",{success:function(n){e(n)},error:function(n){!_.isUndefined(t)&&_.isFunction(t)?t(n):console&&console.warn(n)},data:n})}}}var t;return{getInstance:function(){return t||(t=e()),t}}}(jQuery));
!function(t){"use strict";t(document).on("ready",function(){function e(t){return Registry._get(t)}var n=e("common").getPage();if(n)switch(n){case"tm_pg_media":e("pg-content").init();break;case"gallery":e("gl-content").init()}t(".tm-pg_page-title div").remove()})}(jQuery);
Registry.register("notification",function(t){"use strict";function n(t){return Registry._get(t)}function e(){return{callback:null,_popup:{main:"#popup-dialog-wraper",title:".tm-pg_library_popup-dialog-title",content:".tm-pg_library_popup-dialog-content"},init:function(){t(i._popup.main).on("click.notification",i._popup.content+" a.tm-pg_btn-primary",i.onClickYes.bind(this)),t(i._popup.main).on("click.notification",i._popup.title+" a",i.onClickClose.bind(this)),t(i._popup.main).on("click.notification",i._popup.content+" a.tm-pg_btn-default",i.onClickClose.bind(this))},onClickClose:function(n){n.preventDefault(),t(i._popup.main).hide()},onClickYes:function(n){n.preventDefault(),t(i._popup.main).hide(),i.callback&&_.isFunction(i.callback)&&i.callback()},show:function(t,n){noty({theme:"tm-pg-noty-theme",timeout:5e3,text:i.getText(t,n),layout:"tmPgTopRight",animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:500}})},getLangData:function(t,e){e=e||n("pg-content").getSelectedIds();var i,o="all";return _.isUndefined(t)&&_.isEqual(e.length,1)&&(t=e[0]),_.isUndefined(t)||(o=n("pg-content").getType(t),i=_.isEqual(o,"img")?{name:n("pg-content").getContent(t,o).filename}:{name:n("pg-content").getContent(t,o).post.post_title}),{replase:i,type:o}},getText:function(n,e){var i=tm_pg_admin_lang[n]||"";return _.isEmpty(i)||_.isUndefined(e)||!_.isObject(e)||t.each(e,function(t,n){i=i.replace("%"+t+"%",n)}),i},showDialog:function(n,e,o){var p=i.getText(n,e);t(i._popup.main+" h5").text(p),t(i._popup.main).show(),i.callback=o}}}var i;return{getInstance:function(){return i||(i=e()),i}}}(jQuery));
Registry.register("upload",function(e){"use strict";function r(e){return Registry._get(e)}function o(){return{pluopload:!1,uploader_init:function(){var o,a;this.pluopload||(d||"flash"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty("send_binary_string")||(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0),plupload.addFileFilter("mime_types",function(o,t,a){var d=r("grid").getView(),n=t.name.slice((Math.max(0,t.name.lastIndexOf("."))||1/0)+1),i=this;(_.isUndefined(o)||_.isEmpty(o))&&(o=e(r("grid")._main[d]+" #plupload-browse-button").attr("accept").replace(/\./g,"").split(",")),e.inArray(n.toLowerCase(),o)!==-1?a(!0):(i.trigger("Error",{code:plupload.FILE_EXTENSION_ERROR,message:uploader.errorMap.FILE_EXTENSION_ERROR(t),file:t}),a(!1))}),wpUploaderInit.drop_element=document.body,wpUploaderInit.dropzone=document.body,wpUploaderInit.container=document.body,uploader=new plupload.Uploader(wpUploaderInit),uploader.bind("Init",function(r){var o,t,a=r.features.dragdrop,d=e("body");return setResize(getUserSetting("upload_resize",!1)),"html4"===r.runtime&&e(".upload-flash-bypass").hide(),d.toggleClass("supports-drag-drop",!!a),a?(d.bind("dragover.wp-uploader",function(){o&&clearTimeout(o),t||(d.trigger("dropzone:enter").addClass("drag-over"),t=!0)}),void e(".uploader-window").bind("dragleave.wp-uploader, drop.wp-uploader",function(){o=setTimeout(function(){t=!1,d.trigger("dropzone:leave").removeClass("drag-over")},0)})):d.unbind(".wp-uploader")}),uploader.init(),uploader.bind("FilesAdded",function(o,t){e("body").unbind("dragleave.wp-uploader"),e("body").removeClass("drag-over");var a=e("p.no-media"),d="",n=r("grid"),i=t.length,l=n.getView();for(a[0]&&a.remove(),e("#media-upload-error").empty(),uploadStart();i--;)d+=n.addItem(t[i].id);e(n.getSelector(l,"img","_addItem")).parents(".tm-pg_column").after(d),o.refresh(),o.start()}),uploader.bind("UploadFile",function(e,r){fileUploading(e,r)}),uploader.bind("UploadProgress",function(e,r){t.uploadProgress(e,r)}),uploader.bind("FileUploaded",function(e,r,o){try{o=JSON.parse(o.response)}catch(e){return t.uploadError(pluploadL10n.default_error,e,r)}return!_.isObject(o)||_.isUndefined(o.success)?t.uploadError(pluploadL10n.default_error,null,r):o.success?void t.fileUploaded(r,o):t.uploadError(o.data.message,o.data,r)}),uploader.bind("Error",function(e,r){for(o in uploader.errorMap)if(r.code===plupload[o]){a=uploader.errorMap[o],_.isFunction(a)&&(a=a(r.file,r));break}t.uploadError(a,r,r.file),e.refresh()}),uploader.bind("UploadComplete",function(e,r){uploader.unbindAll(),t.uploadComplete()}),uploader.errorMap={FAILED:pluploadL10n.upload_failed,IMAGE_FORMAT_ERROR:pluploadL10n.not_an_image,IMAGE_MEMORY_ERROR:pluploadL10n.image_memory_exceeded,IMAGE_DIMENSIONS_ERROR:pluploadL10n.image_dimensions_exceeded,GENERIC_ERROR:pluploadL10n.upload_failed,IO_ERROR:pluploadL10n.io_error,HTTP_ERROR:pluploadL10n.http_error,SECURITY_ERROR:pluploadL10n.security_error,FILE_EXTENSION_ERROR:function(e){return tm_pg_admin_lang.FILE_EXTENSION_ERROR.replace("%filename%",e.name)},FILE_SIZE_ERROR:function(e){var r=tm_pg_admin_lang.FILE_SIZE_ERROR.replace("%filename%",e.name).replace("%size%",t.formatSizeUnits(parseInt(uploader.settings.filters.max_file_size)));return r}},this.pluopload=!0)},initCloseButton:function(o){e(r("grid")._main[o]+" button.close").on("click",function(){t.closeUploader(o)})},closeUploader:function(o){o=o||r("grid").getView();var t=e(r("grid")._main[o]+" button.close").attr("parent");r("grid").toggleAddPhotoBtn(),t&&e("#"+t).remove(),this.pluopload=!1},loadUploader:function(o){var a=r("grid").getView();e(r("grid")._main[a]+" .tm-pg_upload_container").html(o.html),t.initCloseButton(a),t.uploader_init()},formatSizeUnits:function(e){for(var r=["B","KB","MB","GB","TB"],o=r.length-1,t=0,a=1024;e>a&&t<o;t++)e/=a;return e},uploadComplete:function(){var e=r("pg-folder"),o=r("grid");a=[],t.closeUploader(),r("notification").show("upload_complite"),e._ID?(e.updateFolder(),e.getLength("img")&&o.toggleSelectAllBtn("img","show")):r("pg-content").getLength("img")&&o.toggleSelectAllBtn("img","show")},uploadProgress:function(o,t){var a=r("grid").getItem(t.id,"img").parent(".tm-pg_column");e(".tm-pg_library_item_loading_container > span",a).text(t.percent+"%"),e(".tm-pg_library_item_loading_bar",a).css("width",t.percent+"%")},fileUploaded:function(e,o){if(o.success){var d=r("grid"),n=r("pg-folder");d.getItem(e.id,"img").attr("data-id",o.data.id),r("pg-content").setContent(o.data.id,"",o.data,"img","prepend"),d.buildItem(o.data.id),d.checkItem(d.getItem(o.data.id,"img")),n._ID&&n.setContent(o.data.id,o.data,"img","prepend"),a.push(o.data.id)}else t.uploadError(e,o.data)},uploadError:function(e,o,t){r("notification").show("error")}}}var t,a=[],d=navigator.userAgent.indexOf("Trident/")!==-1||navigator.userAgent.indexOf("MSIE ")!==-1;return{getInstance:function(){return t||(t=o()),t}}}(jQuery));
Registry.register("pg-content",function(e){"use strict";function t(e){return Registry._get(e)}function n(){return{_scrollCotainer:"#tm-pg-scroll-cotainer",_body:".tm-pg_body-sidebar_container",_preloader:".tm-pg_library_loading",_types:["img","album","set"],_loadMore:".tm-pg-load-more",_content:{img:[],album:[],set:[]},_lastRequest:!1,_imgCount:0,getContent:function(t,n){try{var i;return t=Number(t),n=n||o.getType(t),_.isEqual(0,t)?i=o._content[n]:e.each(o._content[n],function(e,r){if(!_.isUndefined(r)){var c=r.id||r.ID;_.isEqual(t,Number(c))&&(i=o._content[n][e])}}),i}catch(e){console.warn(e)}},getIds:function(e){try{var n=[],i=t("pg-folder");return i._ID>0?_.each(i._items[e],function(e){_.isUndefined(e)||n.push(e.id||e.ID)}):_.each(o._content[e],function(e){_.isUndefined(e)||n.push(e.id||e.ID)}),n}catch(e){console&&console.warn(e.message)}},getLength:function(e){try{return o._content[e].length}catch(e){console&&console.warn(e)}},setContent:function(e,n,i,r,c){try{r=r||o.getType(e),c=c||"append";var a=o.getContent(e,r);if(_.isEmpty(n))if(_.isUndefined(a))_.isEqual(c,"append")?o._content[r].push(i):o._content[r]=t("common").prependArr(i,o._content[r]);else{var s=o._content[r].indexOf(a);o._content[r][s]=i}else if(!_.isUndefined(a)){var s=o._content[r].indexOf(a);o._content[r][s][n]=i}}catch(e){console&&console.warn(e.message)}},getType:function(e){try{var t=!1;return e=Number(e),_.each(o._types,function(n){_.each(o._content[n],function(o){if(!_.isUndefined(o)){var i=o.id||o.ID;_.isEqual(e,Number(i))&&(t=n)}})}),t}catch(e){console.warn(e)}},deleteContent:function(t,n){try{t=Number(t),n=n||o.getType(t),e.each(o._content[n],function(e,i){if(!_.isUndefined(i)){var r=i.id||i.ID;_.isEqual(t,Number(r))&&o._content[n].splice(e,1)}})}catch(e){console.warn(e)}},initScrollbar:function(t){t=t||15,setTimeout(function(){var n=e(o._scrollCotainer).offset().top,i=window.innerHeight-n-t;e(o._scrollCotainer).height(i)},1e3),e(o._scrollCotainer).scrollTop(0)},scrollTo:function(n,i,r,c){i=i||500,r=r||50,e(o._scrollCotainer).scrollTop(0);var a=n.offset().top,s=e(t("pg-folder")._title).offset().top,l=e(t("pg-folder")._back).offset().top,d=e(t("pg-top-bar")._container).offset().top;e(o._scrollCotainer).animate({scrollTop:a-d-s-l-r},i,function(){!_.isUndefined(c)&&_.isFunction(c)&&c()})},init:function(){var n=t("common"),i=t("grid"),r=t("accordion");t("notification").init(),t("pg-right").initScrollbar(),o.initScrollbar(),t("pg-top-bar").addTopBar(),t("pg-right").initRightEvents(),t("pg-folder").folderEvents(),t("pg-popup").initEvents(),t("pg-top-bar").init(),t("set").initEvents(),t("album").initEvents(),t("cover").initEvents(),i.initEvents(),o.toggleDisable(!0),e(o._preloader).hide(),n.loadFolders({action:"get_sets"},function(t){o.renderGrid({type:"set",data:t.posts}),o.getLength("set")&&i.toggleSelectAllBtn("set","show"),o.showGrid({type:"set"}),r.accordion(e(i._parent.set+" .accordion")),n.loadFolders({action:"get_albums"},function(t){o.renderGrid({type:"album",data:t.posts}),o.getLength("album")&&i.toggleSelectAllBtn("album","show"),o.showGrid({type:"album"}),r.accordion(e(i._parent.album+" .accordion")),n.loadImages({},function(t){t.posts&&o.renderGrid({type:"img",data:t.posts}),t.last?(o._lastRequest=t.last,e(o._loadMore).hide()):t.count&&(_.isEqual(t.images_count,t.count)?(o._lastRequest=!0,e(o._loadMore).hide()):e(o._loadMore).show(),o._imgCount=t.count),r.accordion(e(i._parent.img+" .accordion")),o.showGrid({type:"img"}),o.getLength("img")&&i.toggleSelectAllBtn("img","show"),o.toggleDisable(!1)})})})},toggleDisable:function(t){_.isUndefined(t)&&(t=!0),t?e(o._body).addClass("tm-pg_disable"):e(o._body).removeClass("tm-pg_disable")},renderGrid:function(e){e=e||{},e.type=e.type||!1;var n=t("grid"),i=t("folder");e.type?(e.data=e.data||o._content[e.type],n.init(e.data,e.type),i.renderRightSelect(e.type),n.preCheckedAll()):_.each(o._types,function(e){n.init(o._content[e],e),i.renderRightSelect(e),n.preCheckedAll()})},showGrid:function(n){var i=t("grid");n=n||{},n.type=n.type||!1,n.view=n.view||i.getView(),n.type?e(i.getSelector(n.view,n.type,"_container")).show():_.each(o._types,function(t){e(i.getSelector(n.view,t,"_container")).show()})},getSelectedIds:function(n){var i=[],r=t("grid"),c=r.getView();if(_.isUndefined(n)){var a=o.getAllSelectedIds();_.each(o._types,function(e){_.each(a[e],function(e){i.push(e)})})}else{var s=e(r.getSelector(c,n,"_item",".checked"));e.each(s,function(t,n){i[t]=e(n).data("id")})}return i},getAllSelectedIds:function(){var e=o.getSelectedIds("img"),t=o.getSelectedIds("album"),n=o.getSelectedIds("set"),i={img:e,album:t,set:n,count:e.length+t.length+n.length};return i}}}var o;return{getInstance:function(){return o||(o=n()),o}}}(jQuery));
Registry.register("pg-editor",function(t){"use strict";function e(t){return Registry._get(t)}function i(){function i(t,e){var i={};switch(t){case"rotate":i.angle=e.rotation_angle;break;case"focus_point":i.x=e.focus_point_x,i.y=e.focus_point_y,i.width=e.image.width(),i.height=e.image.height()}return i}return n={},Object.defineProperties(n,{initialized:{configurable:!1,enumerable:!1,writable:!0,value:!1},$editorContainer:{configurable:!1,enumerable:!0,writable:!0,value:null},data:{configurable:!1,enumerable:!0,writable:!0,value:{}},viewTpl:{configurable:!1,enumerable:!0,writable:!0,value:null},onDestruct:{configurable:!1,enumerable:!0,writable:!0,value:null}}),s=Backbone.sync,Backbone.sync=function(o,r,a){var s=r.attributes.operation,l={action:s,controller:"image",id:r.attributes.post_data.id},d=e("pg-content"),g=e("notification");t.extend(l,i(r.attributes.operation,r.attributes)),d.toggleDisable(),e("common").wpAjax(l,function(t){r.set("modified",!1),n.view.updateImages(t),d.toggleDisable(!1),g.show(s)},function(t){alert("Error! Could not save image right now!"),r.set("modified",!1),d.toggleDisable(!1),g.show("error")})},n.initialize=function(i,o,s,m,f){return m=m||!0,u=f||u,c=e("grid").getView(),t(e("pg-top-bar")._container).hide(),_.isEqual(c,"folder")&&(t(e("pg-folder")._breadcrumbs.main).addClass("hidden"),t(e("pg-folder")._back).addClass("hidden"),t(e("pg-folder")._title).addClass("hidden")),i.show().animate({opacity:1},l).parent().addClass("editor-enabled"),n.$editorContainer=i,n.viewTpl=o,n.data=s,m&&e("pg-right").init([s.id]),r=Backbone.Model.extend({defaults:{post_data:null,real_rotation_angle:0,rotation_angle:0,focus_point_x:0,focus_point_y:0,image:null,modified:!1,controls:{},currentIndex:null,selectedImages:[]},initialize:function(){this.set("currentIndex",this.attributes.selectedImages.indexOf(this.attributes.post_data.id))},getCurrentIndex:function(){return this.get("currentIndex")},getNextIndex:function(){var t=this.get("currentIndex"),e=this.get("selectedImages").length;return t+=1,t>e-1&&(t=0),this.set("currentIndex",t),t},getPreviousIndex:function(){var t=this.get("currentIndex"),e=this.get("selectedImages").length;return t-=1,t<0&&(t=e-1),this.set("currentIndex",t),t},getNextSelectedID:function(){return this.get("selectedImages")[this.getNextIndex()]},getPreviousSelectedID:function(){return this.get("selectedImages")[this.getPreviousIndex()]},rotate:function(e){t(".tm-pg_editor_focus-box_image-layer").addClass("tm-pg_editor_rotate");var i=this.get("real_rotation_angle");i="left"===e?i-90:"right"===e?i+90:i,this.set("real_rotation_angle",i),i*=-1,this.set("rotation_angle",i%360)}}),a=Backbone.View.extend({template:n.viewTpl,events:{"click .tm-pg_editor_controls_navigate_previous":"navigatePrevious","click .tm-pg_editor_controls_navigate_next":"navigateNext","click .tm-pg_editor_controls_left-rotate":"rotateLeft","click .tm-pg_editor_controls_right-rotate":"rotateRight","click .tm-pg_editor_controls_focus":"setFocusPoint","click .tm-pg_editor_controls_cancel":"cancel","click .tm-pg_editor_controls_save":"save"},initialize:function(){this.listenTo(this.model,"change:real_rotation_angle",this.rotate),this.listenTo(this.model,"change:modified",this.onImageModified),this.unlockControls()},setCoords:function(e,i){var o,n=g.offset();return o={x:e.x-i.width()/2-n.left,y:e.y-i.height()/2-n.top},i.css({top:o.y,left:o.x}),t(".tm-pg_editor_focus-box_image_visible-layer",i).css({top:-o.y,left:-o.x}),o},render:function(){var e,i,o=this,n={},r=220,a=window.innerHeight-r;return o.$el.html(o.template(o.model.attributes)),i=t("#tm-pg-editor-image img",o.$el),i.css("opacity","0"),t("#tm-pg-editor").css("opacity","0"),t("#tm-pg-editor-image").height(a),t("#tm-pg-editor-image").parent().height(a),setTimeout(function(){_.isEqual(u.length,1)?t(".tm-pg_editor_image-navigations").hide():t(".tm-pg_editor_image-navigations").show(),i.height()>window.innerHeight-r&&i.height(window.innerHeight-r),i.animate({opacity:1},l,function(){t("#tm-pg-editor").css("opacity","1"),o.model.set("image",t("#tm-pg-editor-image",o.$el)),Object.keys(o.events).forEach(function(i){i=i.split(" ")[1],e=t(i,o.$el),n[i.replace(".tm-pg_editor_controls_","")]=e}),o.model.set("controls",n),0===o.model.get("selectedImages").length&&(n.navigate_previous.attr("disabled",!0).hide(),n.navigate_next.attr("disabled",!0).hide(),t(".tm-pg_editor_image-counter",o.$el).hide()),o.initFocusPointEvents(),o.onImageModified(null)})},l),this},onImageModified:function(){var t=this,e=t.model.get("controls");t.model.get("modified")?e.save.removeAttr("disabled"):e.save.attr("disabled",!0)},updateImages:function(e){var r,a,s=this,l=Registry._get("pg-content"),d=Registry._get("grid"),g=new Date,c=e.posts[0],u=c.id;l.setContent(u,"",c),d.buildItem(u),setTimeout(function(){var e=[];Object.keys(c.thumbnails).forEach(function(e){r='="'+c.thumbnails[e].url+'"',a=c.thumbnails[e].url+"?"+g.getTime(),c.thumbnails[e].url=a,t("img[src"+r+"]").attr("src",a)}),e=c.thumbnails,l.setContent(u,"thumbnails",e),t(".tm-pg_editor_focus-box_image_visible-layer").css("background-image",'url("'+c.thumbnails.copy.url+"?"+g.getTime()+'")')},1e3),s.resetEditor(function(){n.initialize(i,o,l.getContent(u,"img"))})},initFocusPointEvents:function(){function e(e,i){var o=t(e.target).height(),n=t(e.target).width(),r=0,a=0;return r=_.isEqual(i.position.top,0)?i.offset.top+o/2:i.position.top>=g.height()-o?i.offset.top+o/2:e.clientY,a=_.isEqual(i.position.left,0)?i.offset.left+n/2:i.position.left>=g.width()-n?i.offset.left+n/2:e.clientX,{x:a,y:r}}g=this.model.get("image");var i=t(".tm-pg_editor_focus-box",g),o=this;i.draggable({zIndex:9e3,revert:!1,scroll:!0,appendTo:"body",containment:".tm-pg_editor_image img",drag:function(t,n){var r=e(t,n);o.setCoords(r,i)},stop:function(n,r){var a=e(n,r),s=t(n.target).height(),l=t(n.target).width();o.setCoords(a,i),o.model.set("focus_point_x",r.position.left+l/2),o.model.set("focus_point_y",r.position.top+s/2)},cursor:"move",cursorAt:{top:125,left:125}})},lockControls:function(t,e){t=t||[],e=e||!1,e||(t.push("cancel"),t.push("save"));var i=this;d=i.model.get("controls"),Object.keys(d).forEach(function(e){0>t.indexOf(e)&&d[e].attr("disabled",!0)})},unlockControls:function(t){t=t||[];var e=this;d=e.model.get("controls"),Object.keys(d).forEach(function(e){0>t.indexOf(e)&&d[e].removeAttr("disabled")})},navigatePrevious:function(t){t.preventDefault();var e=this;return 0!==e.model.get("selectedImages").length&&void e.resetEditor(function(){n.initialize(i,o,Registry._get("pg-content").getContent(e.model.getPreviousSelectedID(),"img"))},"left")},navigateNext:function(t){t.preventDefault();var r=this;return 0!==r.model.get("selectedImages").length&&void r.resetEditor(function(){n.initialize(i,o,e("pg-content").getContent(r.model.getNextSelectedID(),"img"))},"right")},rotate:function(){var t,e,i=this.model.get("real_rotation_angle"),o=this.model.get("image"),r=o.width(),a=o.height();t=0===Math.abs(i)%180,e="rotate("+_.escape(i||0)+"deg) scale("+(t?1:a/r)+")",o.children().css({transform:e}),console.log(i),_.isEqual(i,0)||_.isEqual(Math.abs(i),360)?(n.view.model.set("modified",!1),this.model.set("modified",!1),this.unlockControls(["left-rotate","right-rotate","save"]),this.lockControls(["left-rotate","right-rotate","navigate_previous","navigate_next","focus","cancel"],!0)):(this.model.set("modified",!0),this.lockControls(["left-rotate","right-rotate"]))},rotateLeft:function(t){t.preventDefault(),this.model.set("operation","rotate"),this.model.rotate("left")},rotateRight:function(t){t.preventDefault(),this.model.set("operation","rotate"),this.model.rotate("right")},setFocusPoint:function(i){i.preventDefault(),this.lockControls(["controls_focus"]),this.model.set("operation","focus_point"),g=this.model.get("image");var o=this.model.get("post_data").id,n=e("pg-content").getContent(o).focus_point,r=t(".tm-pg_editor_focus-box",g),a=t("img",g).width(),s=t("img",g).height(),l=n.x||a/2,d=n.y||s/2;this.initFocusPointEvents(),g.addClass("tm-pg_editor_image_focus-effect").css({width:a,height:s,margin:"0 auto"}),t(".tm-pg_editor_focus-box_image-layer",g).css({width:a,height:s}),r.css({position:"absolute",left:l+"px",top:d+"px"}),this.model.set("focus_point_x",a/2),this.model.set("focus_point_y",s/2),this.setCoords({x:r.offset().left,y:r.offset().top},r),this.model.set("modified",!0)},save:function(t){t.preventDefault();var e=this;e.lockControls([],!0),e.model.save({operation:e.model.get("operation"),rotation_angle:e.model.get("rotation_angle"),focus_point_x:e.model.get("focus_point_x"),focus_point_y:e.model.get("focus_point_y")})},cancel:function(r){r.preventDefault();var a=this.model.get("post_data").id;n.view.model.get("modified")?this.resetEditor(function(){n.initialize(i,o,e("pg-content").getContent(a,"img"))}):this.resetEditor(function(){t(e("pg-top-bar")._container).show(),n.$editorContainer.hide(),e("pg-top-bar").addTopBar();var i=e("grid").getItem(a);e("pg-right").init(),e("pg-content").initScrollbar(),setTimeout(function(){e("pg-content").scrollTo(i,10,150)},1e3)})},resetEditor:function(i,o){var r=!0;return!!n.initialized&&(_.isEqual(c,"folder")&&(t(e("pg-folder")._breadcrumbs.main).addClass("hidden"),t(e("pg-folder")._back).addClass("hidden"),t(e("pg-folder")._title).addClass("hidden")),n.view.model.get("modified")&&(confirm(n.view.model.get("controls").cancel.data("message"))||(r=!1)),r&&(e("pg-right").init(u),n.destruct(i,o)),r)}}),n.view=new a({model:new r({post_data:n.data,selectedImages:u}),el:n.$editorContainer}),n.initialized=!0,n.render(),i.addClass("editor-visible"),n},n.destruct=function(i,o){if(!n.initialized)return!1;var r={opacity:0};i&&o&&(r.left=("right"===o?"+":"-")+"200px"),t("#tm-pg-editor-image",n.$editorContainer).animate(r,l,function(){n.$editorContainer.removeClass("editor-visible"),n.view.undelegateEvents(),n.$editorContainer.children(":not(.hidden):not(.tm-pg_editor)").show(),n.$editorContainer.parent().removeClass("editor-enabled"),n.initialized=!1,_.isEqual(c,"folder")&&(t(e("pg-folder")._breadcrumbs.main).removeClass("hidden"),t(e("pg-folder")._back).removeClass("hidden"),t(e("pg-folder")._title).removeClass("hidden")),i&&i(),_.isFunction(n.onDestruct)&&n.onDestruct.call(n)})},n.init=n.initialize,n.render=function(){return!!n.view&&(n.view.render(),!0)},n}var o,n,r,a,s=null,l=300,d={},g={},c="",u=[];return{getInstance:function(){return o||(o=i()),o}}}(jQuery));
Registry.register("pg-folder",function(e){"use strict";function t(e){return Registry._get(e)}function n(){return{_back:".tm-pg_back-btn",_title:".tm-pg_page-title",_breadcrumbs:{main:".tm-pg_breadcrumbs",item:"#breadcrumbs-item",link:"#breadcrumbs-link",separator:"#breadcrumbs-separator"},_type:"",_items:{img:[],album:[]},_types:["img","album"],_ID:0,_cover:0,_folder:{},_parent:{},_step:40,_count:0,_loadIds:[],_loadData:[],deleteContent:function(t,n){if(t=Number(t),n=n||i.getType(t),e.each(i._items[n],function(e,o){if(!_.isUndefined(o)){var r=o.id||o.ID;_.isEqual(t,r)&&delete i._items[n][e]}}),!_.isUndefined(i._folder.posts)){var o=i._folder.posts.indexOf(t);_.isEqual(-1,o)||i._folder.posts.splice(o,1),o=i._folder.childs[n].indexOf(t),_.isEqual(-1,o)||i._folder.childs[n].splice(o,1)}},getLength:function(e){return i._items[e].length},getContent:function(t,n){try{var o;return t=Number(t),n=n||i.getType(t),_.isEqual(0,t)?o=i._items[n]:e.each(i._items[n],function(e,r){var d=r.id||r.ID;_.isEqual(t,d)&&(o=i._items[n][e])}),o}catch(e){console.warn(e)}},setContent:function(e,n,o,r){e=Number(e),o=o||i.getType(e),r=r||"append";var d=i.getContent(e,o),a=t("common");if(_.isUndefined(d))_.isEqual(r,"append")?i._items[o].push(n):i._items[o]=a.prependArr(n,i._items[o]);else{var l=i._items[o].indexOf(n);i._items[o][l]=n}var l=i._folder.posts.indexOf(e);!_.isUndefined(i._folder.posts)&&_.isEqual(-1,l)&&(_.isEqual(r,"append")?i._folder.posts.push(e):i._folder.posts=a.prependArr(e,i._folder.posts)),l=i._folder.childs[o].indexOf(e),!_.isUndefined(i._folder.childs[o])&&_.isEqual(-1,l)&&(_.isEqual(r,"append")?i._folder.childs[o].push(e):i._folder.childs[o]=a.prependArr(e,i._folder.childs[o]))},getType:function(e){var t=!1;return e=Number(e),_.each(i._types,function(n){_.each(i._items[n],function(i){if(!_.isUndefined(i)){var o=i.id||i.ID;_.isEqual(e,o)&&(t=n)}})}),t},init:function(n,o,r){try{var d=t("grid"),a=t("pg-content"),l=t("pg-top-bar"),s=d.getView();switch(i._ID=n,i._type=o,i.destruct(),i._parent=r||0,i._folder=a.getContent(n),i._cover=i._folder.cover_id,_.isEqual(s,"grid")&&i.toggleView(),_.isUndefined(i._folder)||(t("pg-right").init([i._ID]),i.buildFolder()),i._type){case"set":e(l._addContainer.set).addClass("hidden"),e(d.getSelector("folder","album","_container")).show(),e(d.getSelector("folder","album","_parent")).show(),i.getLength("album")||d.toggleSelectAllBtn("album");break;case"album":e(l._addContainer.album).addClass("hidden"),e(l._addContainer.set).addClass("hidden"),e(d.getSelector("folder","album","_parent")).hide()}e(d.getSelector("folder","img","_container")).show(),i.getLength("img")||d.toggleSelectAllBtn("img"),e(a._scrollCotainer).scrollTop(0),i.checkLoadMore()}catch(e){console&&console.warn(e)}},checkLoadMore:function(){var n=t("pg-content"),o=i._items.img.length+i._items.album.length;_.isEqual(i._folder.posts.length,o)?e(n._loadMore).hide():e(n._loadMore).show()},buildFolder:function(){i.buildHeader();for(var e=t("pg-content"),n=t("grid"),o=i._step+i._count,r=i._count;r<o;r++)_.each(i._types,function(t){if(!_.isUndefined(i._folder.childs[t])){var o=i._folder.childs[t][r];if(!_.isUndefined(o)){var d=e.getContent(o);_.isUndefined(d)?i._loadIds.push(o):(i.setContent(o,d,t),n.init([d],t,"folder"),i.checkLoadMore())}}});i._loadIds.length&&i.loadData(i._loadIds,function(t){i._loadIds=[],_.isUndefined(t)||(_.each(t,function(n){i._items.img.push(n);var o=e.getContent(t.id);_.isUndefined(o)&&i._loadData.push(n)}),n.init(t,"img","folder"))})},loadData:function(e,n){var o={ids:e.join(","),controller:"media",action:"load_data"},r=(t("grid"),t("pg-content"));i._ID>0&&(o.parent=i._ID),r.toggleDisable(!0),t("common").wpAjax(o,function(e){!_.isUndefined(n)&&_.isFunction(n)&&n(e),i.checkLoadMore(),r.toggleDisable(!1)})},removeContent:function(e,n){if(_.isEqual(i._ID,n)){var o=t("grid"),r=t("pg-top-bar");_.each(e,function(e){o.getItem(e).parent().remove(),i.deleteContent(e)}),_.each(i._types,function(e){i.getLength(e)||o.toggleSelectAllBtn(e)}),r.addTopBar(),t("pg-right").init([i._ID]),r.unselectAll()}},buildHeader:function(){e(i._title+" h2").text(i._folder.post.post_title);var t=e(i._breadcrumbs.item).children().clone(),n=e(i._breadcrumbs.separator).children().clone(),o=e(i._breadcrumbs.link).children().clone();e(i._breadcrumbs.main).append(o),e(i._breadcrumbs.main).append(n),_.isEmpty(i._parent)||(o=o.clone(),n=n.clone(),e("a",o).attr("data-id",i._parent.id).text(i._parent.post_title),e(i._breadcrumbs.main).append(o),e(i._breadcrumbs.main).append(n)),t.text(i._folder.post.post_title),e(i._breadcrumbs.main).append(t)},toggleView:function(){var n=t("grid");e(n._main.grid).toggleClass("hidden"),e(n._main.folder).toggleClass("hidden"),e(i._back).toggleClass("hidden"),e(i._title).toggleClass("hidden"),e(i._breadcrumbs.main).toggleClass("hidden"),t("pg-content").initScrollbar()},updateFolder:function(e,n,o){var r=t("pg-content");n=n||r.getType(e),e=e||i._ID,t("common").wpAjax({id:e,type:n,controller:"folder",action:"update"},function(d){_.isEqual(i._type,n)&&(i._folder=d),r.setContent(e,"",d,n),t("grid").buildItem(e),!_.isUndefined(o)&&_.isFunction(o)&&o(d)},function(e){console&&console.error(e)})},folderEvents:function(){e(document).on("click",i._back+" a",i.onClickBack.bind(this))},onClickBack:function(n){n.preventDefault(),i.destruct();var o=t("pg-content"),r=t("grid");t("upload").closeUploader(),i._parent?t("pg-folder").init(i._parent.id,"set"):(i.destruct(),i.toggleView(),i._ID=0,o.renderGrid(),_.each(o._types,function(e){r.toggleSelectAllBtn(e,"show")}),o._lastRequest?e(o._loadMore).hide():e(o._loadMore).show()),t("pg-top-bar").addTopBar()},destruct:function(){var n=t("pg-content"),o=t("pg-top-bar"),r=t("grid");e(r._selectAll).removeClass("selected"),n._lastRequest?e(n._loadMore).hide():(_.each(i._loadData,function(e){n.deleteContent(e.id,"img")}),e(n._loadMore).show()),i._loadData=[],i._count=0,i._items={img:[],album:[]},t("cover").resetCover(),e(o._addContainer.set).removeClass("hidden"),e(o._addContainer.album).removeClass("hidden"),e(i._breadcrumbs.main).children().remove(),_.each(n._types,function(t){e(r.getSelector("folder",t,"_item")).parent().remove(),e(r.getSelector("grid",t,"_item")).parent().remove()}),t("pg-right").refresh()}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("media-popup",function(e){"use strict";function t(e){return Registry._get(e)}function o(){return{frame:!1,selected:[],init:function(){return n.frame?void n.frame.open():(n.frame=wp.media({title:"Select or Upload Media to selected folder",button:{text:"Add media to folder"},library:{type:"image"},multiple:!0}),n.frame.on("select",function(){n.appendItems()}),e.extend(wp.Uploader.prototype,{success:n.onUploadImage.bind(this)}),void n.frame.open())},onUploadImage:function(e){var o=t("grid"),n=t("pg-folder");_.isEqual(e.attributes.type,"image")&&n.loadData([e.id],function(e){o.renderContent(e,"prepend","img","grid")})},appendItems:function(){var e=n.frame.state().get("selection").toJSON(),t=[];_.each(e,function(e){t.push(e.id)}),n.addToFolder(t)},addToFolder:function(o,d){d=d||0;var i=t("pg-content"),r=t("pg-folder"),a=t("grid"),l=r._ID,p=r._type,c={id:l,value:o[d],action:"add_to_folder",controller:"folder"};i.toggleDisable(),t("common").wpAjax(c,function(){var c=i.getContent(l,"img");_.isUndefined(c)||t(p).addRightCallback(o,d,l),_.isUndefined(o[++d])?r.updateFolder(l,p,function(){_.each(i._types,function(t){e(a.getSelector("folder",t,"_item")).parent().remove()}),r.buildFolder(),i.toggleDisable(!1);var o=i.getContent(l,p).post.post_title;t("notification").show("added_to_"+p,{name:o})}):n.addToFolder(o,d)})}}}var n;return{getInstance:function(){return n||(n=o()),n}}}(jQuery));
Registry.register("pg-popup",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{_container:"#popup-wraper",_title:".tm-pg_library_popup-title",_item:{main:"#popup-item",link:".tm-pg_library_popup-item_link"},_content:".tm-pg_library_popup-content",status:"album",init:function(n){t(i._container).show(),i.buildPopup(n),e("common").initScrollbar(i._content),i.status=n},initEvents:function(){t(document).on("click",i._item.link,i.onClickItem.bind(this)),t(document).on("click",i._title+" a",i.onClickClose.bind(this))},onClickClose:function(e){e.preventDefault(),t(i._content).children().remove(),t(i._container).hide()},onClickItem:function(e){e.preventDefault(),i.addToFolder(t(e.currentTarget),i.status),t(i._content).children().remove(),t(i._container).hide()},addToFolder:function(t,n,o){o=o||0;var a=e("pg-content"),l=e("pg-folder"),r=a.getSelectedIds(),c=t.data("id"),d={id:c,value:r[o],action:"add_to_folder",controller:"folder"};a.toggleDisable(),e("common").wpAjax(d,function(){if(e(n).addRightCallback(r,o,c),_.isUndefined(r[++o])){l.updateFolder(c,n),a.toggleDisable(!1);var d=a.getContent(c,n).post.post_title;e("notification").show("added_to_"+n,{name:d})}else i.addToFolder(t,n,o)})},buildPopup:function(n){var o=_.isEqual(n,"album")?tm_pg_admin_lang.albums:tm_pg_admin_lang.sets,a=e("pg-content")._content[n];_.isEmpty(a)||_.each(a,function(t){i.addItem(t,n)}),t(i._title+" h5").text(o)},addItem:function(e,n){var o=t(i._item.main).clone().children();t(i._item.link,o).attr("data-id",e.id),_.isEmpty(e.cover_img[n])||t(i._item.link+" img",o).removeClass("hide").attr("src",e.cover_img.big[0]),t(i._item.link+" figcaption",o).text(e.post.post_title),t(i._content).append(o)}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("pg-right",function(e){"use strict";function t(e){return Registry._get(e)}function i(){return{_clone:"#right-image-clone",_slidebar:"#sidebar-content",_container:{album:"#sidebar-content .tm-pg_sidebar_image-albums",set:"#sidebar-content .tm-pg_sidebar_image-sets"},_scrollContainer:".tm-pg_sidebar_container",disable:!1,ids:[],init:function(i){if(a.disable)return!1;var n=t("grid").getView();a.ids=i||t("pg-content").getSelectedIds(),a.showSlidebar(a.ids,function(){if(a.addItem(a.ids),_.isEqual(a.ids.length,1))a.buildMediaDetails(a.ids.join(","));else if(a.ids.length>1)a.buildMultiDetails();else if(_.isEqual(n,"grid"))e(a._slidebar).attr("data-id",0).html("");else{var i=t("pg-folder")._ID;a.init([i])}e(a._slidebar+" .select2").select2()})},toggleDisable:function(t){_.isUndefined(t)&&(t=!0),a.disable=t,t?e(a._scrollContainer).addClass("tm-pg_disable"):(e(a._scrollContainer).removeClass("tm-pg_disable"),a.initScrollbar())},refresh:function(){e(a._slidebar).children().remove()},initRightEvents:function(){a.initScrollbar(),t("tag").init(),t("category").init(),e(a._slidebar).on("click","label span",a.onClickLabel.bind(this)),e(a._slidebar).on("change",".tm-pg_sidebar_image_main-description input",a.onChangeTitle.bind(this))},onChangeTitle:function(i){var n={},s=a.ids;n.value=e(i.currentTarget).val(),n.type=e(i.currentTarget).attr("name"),n.id=s.join(","),a.toggleDisable(!0),a.saveDetails(n,function(e){_.each(e,function(e){t("pg-content").setContent(e.id,"",e),t("grid").buildItem(e.id)}),t("notification").show("edit_"+n.type)})},onClickLabel:function(t){t.preventDefault();var i=e(t.currentTarget).parent();i.next('input[type="text"]').length?i.next('input[type="text"]').focus():e('input[type="text"]',i.next("form")).length&&e('input[type="text"]',i.next("form")).focus()},showSlidebar:function(t,i){e(a._scrollContainer).show("fade",{},500,i)},saveDetails:function(i,n){var s={controller:"media",action:"save_details"};e.extend(s,i),t("common").wpAjax(s,function(e){!_.isUndefined(n)&&_.isFunction(n)&&n(e),a.toggleDisable(!1)},function(e){console.warn("Some error!!!"),console.warn(e)})},initScrollbar:function(){var t=innerHeight-e(a._scrollContainer).offset().top-30;e(a._scrollContainer).height(t)},addItem:function(t){var i=e(a._clone).clone();e(a._slidebar).data("id",t).html(i.children())},buildMediaDetails:function(i){try{var n=t("pg-content").getContent(i),s=t("pg-content").getType(i),r=a._slidebar,l=t("folder");switch(s){case"img":e(r+' div[data-type="album-container"]').removeClass("hidden"),e(r+' div[data-type="set-container"]').removeClass("hidden"),l.updateSlidebar(n.albums,"album"),l.updateSlidebar(n.sets,"set"),e(r+" .tm-pg_sidebar_image img").attr("src",n.thumbnails.right.url),e(r+" .tm-pg_sidebar_image-description").removeClass("hidden"),e(r+' p[data-type="filename"] span.value').text(n.filename),e(r+' p[data-type="dimensions"] span.value').text(n.image.width+" × "+n.image.height),e(r+" .tm-pg_sidebar_image_container").removeClass("hidden");break;case"album":e(r+' div[data-type="set-container"]').removeClass("hidden"),l.updateSlidebar(n.sets,"set");case"set":_.isUndefined(n.cover_img)||_.isEmpty(n.cover_img.right)||(e(r+" .tm-pg_sidebar_image img").attr("src",n.cover_img.right[0]),e(r+" .tm-pg_sidebar_image_container").removeClass("hidden"))}e(r+' .tm-pg_sidebar_image_main-description input[name="post_title"]').val(n.post.post_title),e(r+' .tm-pg_sidebar_image_main-description input[name="post_content"]').val(n.post.post_content),t("tag").addTags(n.tags),t("category").selectCats(n.categories),_.isEqual(n.status,"private")?e(r+" #image-visibility_unlisted").prop("checked",!0):e(r+" #image-visibility_public").prop("checked",!0)}catch(e){console&&console.warn(e.message)}},buildMultiDetails:function(){try{var i=a._slidebar,n=a.ids,s=t("folder"),r=t("term");e(i+" .tm-pg_sidebar_image_container").addClass("hidden"),n.length<10&&(r.addMultiTerms("tags"),r.addMultiTerms("categories")),s.multyUpdateSlidebar("albums"),s.multyUpdateSlidebar("sets");var l=[],d=[],o=[],c=[];e.each(n,function(i,a){var n=t("pg-content").getContent(a);c.push(t("pg-content").getType(a)),i>0?(_.isEqual(e.inArray(n.title,l),-1)&&l.push(n.title),_.isEqual(e.inArray(n.description,d),-1)&&d.push(n.description),_.isEqual(e.inArray(n.status,o),-1)&&o.push(n.status)):(o.push(n.status),l.push(n.title),d.push(n.description))}),_.isEqual(e.inArray("set",c),-1)&&(_.isEqual(e.inArray("album",c),-1)?_.isEqual(e.inArray("img",c),-1)||(e(i+' div[data-type="album-container"]').removeClass("hidden"),e(i+' div[data-type="set-container"]').removeClass("hidden")):e(i+' div[data-type="set-container"]').removeClass("hidden")),_.isEqual(o.length,1)&&(_.isEqual(o[0],"private")?e(i+" #image-visibility_unlisted").prop("checked",!0):e(i+" #image-visibility_public").prop("checked",!0)),_.isEqual(l.length,1)&&e(i+' .tm-pg_sidebar_image_main-description input[name="title"]').val(l[0]),_.isEqual(d.length,1)&&e(i+' .tm-pg_sidebar_image_main-description input[name="description"]').val(d[0])}catch(e){console.warn(e)}}}}var a;return{getInstance:function(){return a||(a=i()),a}}}(jQuery));
Registry.register("pg-top-bar",function(e){"use strict";function t(e){return Registry._get(e)}function n(){return{_clone:{selected:"#selected-topbar",default:"#default-topbar"},_container:".tm-pg_library-filter",_titleTooltip:".tm-pg_library-filter_selected-objects-tooltip",_addContainer:{photo:"a.tm-pg_library-filter_add-photo",album:"a.tm-pg_library-filter_add-album",set:"a.tm-pg_library-filter_add-set"},_addTo:{main:".tm-pg_library-filter_selected-settings_add",menu:".tm-pg_library-filter_selected-settings_add-menu"},init:function(){e(document).on("click",l._addContainer.photo,l.onClickAddPhoto.bind(this)),e(document).on("click",l._addContainer.album,l.onClickAddAlbum.bind(this)),e(document).on("click",l._addContainer.set,l.onClickAddSet.bind(this)),e(document).on("hover",l._addTo.main+" a",l.onHoverAddTo.bind(this)),e(document).on("click",l._addTo.main+" a",l.onClickAddTo.bind(this)),e(document).on("hover",".tm-pg_library-filter_selected-title",l.onHoverShowTooltip.bind(this)),e(document).on("click",".tm-pg_library-filter_selected-close",l.onClickClose.bind(this)),e(document).on("click",".tm-pg_library-filter_selected-settings_delete > a",l.onClickDelete.bind(this))},onClickClose:function(e){e.preventDefault(),l.unselectAll()},onHoverShowTooltip:function(t){e(l._titleTooltip).hasClass("show")?e(l._titleTooltip).removeClass("show"):e(l._titleTooltip).addClass("show")},onClickAddTo:function(n){e(l._addTo.menu).hide();var o=e(n.currentTarget).data("type");t("pg-popup").init(o)},onHoverAddTo:function(t){e(l._addTo.menu).show()},onClickAddSet:function(n){n.preventDefault();var l=t("grid"),o=l.getView(),i=e(l.getSelector(o,"set","_parent"));t("pg-content").scrollTo(i,500,50,function(){l.addNewItem("set")})},onClickAddPhoto:function(n){if(n.preventDefault(),t("pg-folder")._ID>0)t("media-popup").init();else{var l=t("grid"),o=l.getView(),i=e(l.getSelector(o,"img","_parent"));t("pg-content").scrollTo(i,2e3,50,function(){t("image").showUpload()})}},onClickAddAlbum:function(n){n.preventDefault();var l=t("grid"),o=l.getView(),i=e(l.getSelector(o,"album","_parent"));t("pg-content").scrollTo(i,1e3,50,function(){l.addNewItem("album")})},onClickDelete:function(e){e.preventDefault();var n=t("notification"),o=t("pg-content").getSelectedIds(),i=n.getLangData(),a="delete_"+i.type+"_dialog";n.showDialog(a,i.replase,function(){l.deleteItem(o,0)})},selectedInit:function(){var n=t("pg-content").getAllSelectedIds();e(l._titleTooltip+' p[data-type="sets"] span').text(n.set.length),e(l._titleTooltip+' p[data-type="albums"] span').text(n.album.length),e(l._titleTooltip+' p[data-type="photos"] span').text(n.img.length),n.set.length>0?e(l._addTo.main+" a").hide():(e(l._addTo.main+" a").show(),n.album.length>0?e(l._addTo.menu+' a[data-type="album"]').hide():e(l._addTo.menu+' a[data-type="album"]').show()),t("pg-folder")._ID&&t("cover").init()},deleteItem:function(e,n){try{var o=t("grid"),i=t("pg-folder"),a=t("folder"),d=t("pg-content"),r=t("notification"),c=e[n],s=r.getLangData(void 0,e);d.toggleDisable(),o.deleteItem(c,function(t){var p=t[c].sets,u=t[c].albums;_.isUndefined(p)||_.each(p,function(e){i.updateFolder(e,"set")}),_.isUndefined(u)||_.each(u,function(e){i.updateFolder(e,"album")}),o.getItem(c).parent().remove(),d.deleteContent(c),_.each(d._types,function(e){d.getLength(e)||o.toggleSelectAllBtn(e)}),i._ID&&(i.deleteContent(c),_.each(i._types,function(e){i.getLength(e)||o.toggleSelectAllBtn(e)})),l.addTopBar(),_.isEqual(n,e.length-1)&&(i._ID&&i.updateFolder(),a.renderRightSelect("set"),a.renderRightSelect("album"),l.unselectAll(),d.toggleDisable(!1),r.show(s.type+"_deleted",s.replase)),_.isUndefined(e[++n])||l.deleteItem(e,n)})}catch(e){console.warn(e),d.toggleDisable(!1),r.show("error")}},unselectAll:function(){var n=t("grid"),o=t("pg-content"),i=o.getAllSelectedIds();_.each(o._types,function(t){_.each(i[t],function(e){n.getItem(e).removeClass("checked")}),e(n._parent[t]+":visible "+n._selectAll).removeClass("selected"),n.preCheckedAll()}),l.buildTopBar(),t("pg-right").init()},addTopBar:function(){var e=t("pg-content").getAllSelectedIds();e.count>0?l.buildSelectedTopBar(e):l.buildTopBar()},buildTopBar:function(){var t=e(l._clone.default).clone();e(l._container).hasClass("tm-pg_library-filter_selected")&&e(l._container).addClass("hide-box"),setTimeout(function(){e(l._container).removeClass("tm-pg_library-filter_selected").removeClass("hide-box").html(t.children())},500)},buildSelectedTopBar:function(t){e(l._container).addClass("tm-pg_library-filter_selected");var n=e(l._clone.selected).clone();e(".tm-pg_library-filter_selected-title span",n).text(t.count),e(l._container).html(n.children()),l.selectedInit()}}}var l;return{getInstance:function(){return l||(l=n()),l}}}(jQuery));
Registry.register("album",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{tax_name:window.tm_pg_options.tax_names.album,post_type:window.tm_pg_options.post_types.album,_clone:"#album-term-clone",_item:".tm-pg_album_container",initEvents:function(){var n=e("grid"),l=e("pg-right");t(document).on("focusout",n._item.album+".new input:visible",i.onFocusoutAlbumInput.bind(this)),t(document).on("keyup",n._item.album+".new input:visible",i.onKeyupAlbumInput.bind(this)),t(document).on("click",l._slidebar+" .tm-pg_add-to-album_form > button.tm-pg_btn",i.onClickAddToAlbum.bind(this)),t(document).on("click",l._slidebar+" "+i._item+" .tm-pg_album-delete",i.onClickDeleteFromAlbum.bind(this))},onClickDeleteFromAlbum:function(n){n.preventDefault();var l=e("pg-right").ids,o=t(n.currentTarget).parent(),a=o.data("id"),u=0;i.albumAction(l,a,u,"delete_from_folder")},onClickAddToAlbum:function(n){n.preventDefault();var l=e("pg-right").ids,o=t(n.currentTarget).parent(),a=t("select",o).val(),u=0;i.albumAction(l,a,u,"add_to_folder")},onKeyupAlbumInput:function(e){if(e.preventDefault(),13===e.keyCode)return t(e.currentTarget).blur(),!1},onFocusoutAlbumInput:function(e){e.preventDefault();var n=t(e.currentTarget);_.isEmpty(n.val())&&n.val("Album name"),i.addAlbum(n)},albumAction:function(t,n,l,o){var a={},u=t[l];n&&(a.value=u,a.id=n,a.controller="folder",a.action=o,e("pg-right").toggleDisable(!0),e("common").wpAjax(a,function(){_.isEqual(o,"delete_from_folder")?i.removeRightCallback(t,l,n):i.addRightCallback(t,l,n,function(){var t=e("notification"),i=t.getLangData(n);t.show("added_to_"+i.type,i.replase),e("pg-folder").updateFolder(n,"album")}),_.isUndefined(t[++l])||i.albumAction(t,n,l,o)}))},addRightCallback:function(t,n,i,l){var o=t[n],a=e("pg-content").getContent(o).albums,u=a.indexOf(Number(i));_.isEqual(-1,u)&&a.push(Number(i)),_.isEqual(n,t.length-1)&&(_.isEqual(-1,u)&&e("folder").addRightFolder(i,"album"),!_.isUndefined(l)&&_.isFunction(l)&&l(),e("pg-right").toggleDisable(!1))},removeRightCallback:function(t,n,i){var l=t[n],o=e("notification"),a=e("pg-folder"),u=o.getLangData(i),r=e("pg-content").getContent(l).albums,d=r.indexOf(Number(i));_.isEqual(-1,d)||r.splice(d,1),_.isEqual(n,t.length-1)&&(_.isEqual(-1,d)||e("folder").removeRightFolder(i,"album"),o.show("delete_from_"+u.type,u.replase),a._ID&&a.removeContent(t,i),a.updateFolder(i,"album"),e("pg-right").toggleDisable(!1))},addAlbum:function(t,n){var l={},o=e("grid"),a=e("folder"),u=o.getView(),r=t.parents(".tm-pg_library_item");_.isEqual(u,"folder")&&(l.parent=e("pg-folder")._ID),l.type=i.post_type,l.title=t.val(),t.remove(),a.addFolder(l,function(t){r.attr("data-id",t.id),e("pg-content").setContent(t.id,"",t.folder,"album"),o.buildItem(t.id),a.renderRightSelect("album"),o.toggleSelectAllBtn("album","show"),!_.isUndefined(n)&&_.isFunction(n)&&n(t),e("notification").show("add_album",{name:l.title})})}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("category",function(e){"use strict";function t(e){return Registry._get(e)}function i(){return{_input:".tm-pg_add-categories_form input",_container:".tm-pg_sidebar_image-categories",init:function(){var i=t("pg-right")._slidebar;e(i).on("keyup",n._input,function(t){if(13===t.keyCode)return e("button",e(this).parent()).trigger("click"),!1}),e(i).on("click",".tm-pg_add-categories_form button.tm-pg_btn ",function(i){i.preventDefault();var a=t("pg-right").ids,r=e("input",e(this).parent()).val(),c=0;n.categoryAction(a,r,c,"add_term")}),e(i).on("change",'.tm-pg_checkbox-item input[type="checkbox"]',function(){var i=t("pg-right").ids,a=e(this).val(),r=0,c="delete_term";e(this).is(":checked")&&(c="add_term"),n.categoryAction(i,a,r,c)})},categoryAction:function(i,a,r,c){var o,g={};r||e(n._container).addClass("disable"),a&&(g.value=a,g.id=i[r],g.action=c,g.type=tm_pg_options.tax_names.category,o=e('label[for="image-category_'+a+'"]:visible span.name').text(),o?g.field="term_taxonomy_id":(g.field="name",o=a),t("pg-right").toggleDisable(!0),t("term").termAction(g,function(e){n.callback(e,i,r,c,o),_.isUndefined(i[++r])||n.categoryAction(i,a,r,c)}))},callback:function(i,a,r,c,o){var g={},s=a[r];_.each(i,function(e){g=e,t("pg-content").setContent(s,"categories",e)}),_.isEqual(r,a.length-1)&&(e(n._container).removeClass("disable"),a.length>1&&a.length<10?t("term").addMultiTerms("categories"):n.selectCats(g),t("pg-right").toggleDisable(!1),_.isEqual(c,"delete_term")?t("notification").show("delete_category",{name:o}):t("notification").show("add_category",{name:o}))},selectCats:function(i){return!_.isEmpty(i)&&void e.each(i,function(i,n){var a=t("pg-right")._slidebar,r=t("pg-right")._clone;if(e(a+" #image-category_"+n.term_id).length>0)e(a+" #image-category_"+n.term_id).prop("checked",!0);else{var c=e("#cat-clone").clone();e("label",c).attr("for","image-category_"+n.term_id),e("input",c).attr("id","image-category_"+n.term_id).val(n.term_id),e("span.name",c).text(n.name);var o=c.children().clone();e(a+" .tm-pg_sidebar_image-categories").prepend(c.children()),e("input",o).prop("checked",!1),e(r+" .tm-pg_sidebar_image-categories").prepend(o)}})}}}var n;return{getInstance:function(){return n||(n=i()),n}}}(jQuery));
Registry.register("cover",function(e){"use strict";function t(e){return Registry._get(e)}function n(){return{_content:".tm-pg_library-filter_selected-settings_cover",initEvents:function(){e(document).on("click",o._content+'[data-type="set_cover"]',o.onClickSetCover.bind(this)),e(document).on("click",o._content+'[data-type="unset_cover"]',o.onClickUnsetCover.bind(this))},onClickUnsetCover:function(e){e.preventDefault(),o.update_cover(0,function(){t("pg-folder").updateFolder()})},onClickSetCover:function(e){e.preventDefault();var n=t("pg-content").getSelectedIds();o.update_cover(n[0],function(){t("pg-folder").updateFolder()})},init:function(){var n=t("pg-content").getSelectedIds();n.length>1?e(o._content).hide():_.isEqual(n[0],t("pg-folder")._cover)?(e(o._content+'[data-type="unset_cover"]').show(),e(o._content+'[data-type="set_cover"]').hide()):(e(o._content+'[data-type="set_cover"]').show(),e(o._content+'[data-type="unset_cover"]').hide())},resetCover:function(){e(o._content+'[data-type="unset_cover"]').hide(),e(o._content+'[data-type="set_cover"]').hide()},update_cover:function(e,n){var c=t("pg-folder"),r=t("pg-content"),i=t("notification"),a={controller:"folder",action:"change_cover",parent_id:c._ID,id:e};r.toggleDisable(),t("common").wpAjax(a,function(t){t.update&&(c._folder.cover_id=e,c._cover=e),o.init(),!_.isUndefined(n)&&_.isFunction(n)&&n(t),r.toggleDisable(!1);var a="set_cover";e||(a="remove_cover"),i.show(a,{name:c._folder.post.post_title,type:c._type})},function(e){console&&console.warn(e),r.toggleDisable(!1),i.show("error")})}}}var o;return{getInstance:function(){return o||(o=n()),o}}}(jQuery));
Registry.register("folder",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{addFolder:function(n,i){var o={controller:"folder",action:"add_folder"},r=e("pg-content");t.extend(o,n),r.toggleDisable(!0),e("common").wpAjax(o,function(t){!_.isUndefined(i)&&_.isFunction(i)&&i(t),r.toggleDisable(!1)},function(t){console&&console.warn(t),r.toggleDisable(!1),e("notification").show("error")})},renderRightSelect:function(n){try{if(_.isEqual(n,"img"))return!1;var i=e("pg-content").getContent(0,n),o=e("pg-right");if(_.isEmpty(i))return!1;t(o._clone+" .tm-pg_add-to-"+n+"_form select").html("");var r,a="";_.each(i,function(e){_.isUndefined(e)||(r=t("#option-clone").clone(),r.children().attr("value",e.id),r.children().text(e.post.post_title),a+=r.html())}),t(o._clone+" .tm-pg_add-to-"+n+"_form select").append(a)}catch(t){console.warn(t)}},addRightFolder:function(n,i){var o=e("pg-content").getContent(n,i),r=t(e(i)._clone).clone();return!_.isUndefined(o)&&(r.children().attr("data-id",o.id),t("span.name",r).text(o.post.post_title),void t(e("pg-right")._container[i]).append(r.children()))},removeRightFolder:function(n,i){t(e("pg-right")._container[i]+' span[data-id="'+n+'"]').remove()},updateSlidebar:function(t,e){_.each(t,function(t){return!!t&&void i.addRightFolder(t,e)})},multyUpdateSlidebar:function(t){var n=e("pg-right").ids,o=[];switch(_.each(n,function(n){var i=e("pg-content").getContent(n)[t];_.isArray(i)&&o.push(i)}),o=_.flatten(o),_.each(o,function(i){var r=0;_.each(n,function(n){var o=e("pg-content").getContent(n)[t];_.isEmpty(o)||_.each(o,function(t){i===t&&r++})}),_.isEqual(r,n.length)||(o=_.without(o,i))}),o=_.uniq(o),t){case"albums":i.updateSlidebar(o,"album");break;case"sets":i.updateSlidebar(o,"set")}}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("grid",function(e){"use strict";function t(e){return Registry._get(e)}function i(){return{_main:{grid:"#tm-pg-grid",folder:"#tm-pg-folder"},_parent:{img:'div[data-id="photos"]',album:'div[data-id="albums"]',set:'div[data-id="sets"]'},_container:{img:'div[data-id="photos"] .tm-pg_library_photos',album:'div[data-id="albums"] .tm-pg_library_albums',set:'div[data-id="sets"] .tm-pg_library_sets'},_item:{img:'div[data-id="photos"] .tm-pg_library_item',album:'div[data-id="albums"] .tm-pg_library_item',set:'div[data-id="sets"] .tm-pg_library_item'},_addItem:{img:'div[data-id="photos"] .tm-pg_library_item_add > a',album:'div[data-id="albums"] .tm-pg_library_item_add > a',set:'div[data-id="sets"] .tm-pg_library_item_add > a'},_cloneItem:{img:"#image-clone",album:"#album-clone",set:"#set-clone"},_selectAll:".tm-pg_library_grid_header_select_all",_showMore:".tm-pg-load-more .tm-pg_btn.tm-pg_btn-primary",getView:function(){var t="grid";return _.isEqual(e(a._main.folder).is(":visible"),!0)&&(t="folder"),t},getSelector:function(e,t,i,n){return n=n||"",a._main[e]+" "+a[i][t]+n},initEvents:function(){e(document).on("click",a._showMore,a.onClickShowMore.bind(this)),_.each(t("pg-content")._types,function(t){e(document).on("click",a._item[t]+":visible",a.onClickItem.bind(this)),e(document).on("click",a._parent[t]+":visible "+a._selectAll,a.onClickSelectAll.bind(this)),e(document).on("click",a._item[t]+":visible a.tm-pg_library_item-check",a.onClickCheker.bind(this)),e(document).on("click",a._item[t]+":visible a.tm-pg_library_item-zoom",a.onClickZoom.bind(this)),e(document).on("click",a._item[t]+":visible a.tm-pg_library_item-link",a.onClickNext.bind(this)),e(document).on("click",a._addItem[t],a.onClickAddNewItem.bind(this))})},onClickAddNewItem:function(i){i.preventDefault();var n=a.getView(),r=e(i.currentTarget).parent().data("type");switch(r){case"img":t("pg-folder")._ID>0?t("media-popup").init():t("image").showUpload();break;case"album":case"set":a.addNewItem(r,n)}},onClickNext:function(i){i.preventDefault();var n=0,r=e(i.currentTarget).parents(".tm-pg_library_item:visible");_.isEqual(a.getView(),"folder")&&(n=t("pg-folder")._folder),t("pg-folder").init(r.data("id"),r.data("type"),n),t("pg-top-bar").addTopBar()},onClickZoom:function(t){t.preventDefault();var i=e(t.currentTarget).parents(".tm-pg_library_item:visible");a.editItem(i)},onClickCheker:function(t){t.preventDefault();var i=e(t.currentTarget).parents(".tm-pg_library_item:visible");a.checkItem(i)},onClickSelectAll:function(i){i.preventDefault();var n=e(i.currentTarget),r=".tm-pg_library_item:visible";n.toggleClass("selected"),n.hasClass("selected")?e(r,n.parents(".accordion-content")).addClass("checked"):e(r,n.parents(".accordion-content")).removeClass("checked"),a.preCheckedAll(),t("pg-right").init(),t("pg-top-bar").addTopBar()},onClickItem:function(i){i.preventDefault();var n=e(i.currentTarget),r=n.data("type");if(_.isEqual(i.target,i.currentTarget))if(n.hasClass("pre-checked")||n.hasClass("checked"))a.checkItem(n);else switch(r){case"img":a.editItem(n);break;case"album":case"set":var d=0;_.isEqual(a.getView(),"folder")&&(d=t("pg-folder")._folder),t("pg-folder").init(n.data("id"),r,d)}else n.hasClass("new")&&(e(i.target).hasClass("material-icons")||a.checkItem(n))},onClickShowMore:function(i){i.preventDefault();var n=t("pg-content"),r=t("pg-folder");return r._ID>0?(r._count+=r._step,r.buildFolder(),!1):(n.toggleDisable(!0),void t("common").loadImages({count:n._imgCount},function(t){n.showGrid({type:"img"}),t.posts&&n.renderGrid({type:"img",data:t.posts}),t.last?(n._lastRequest=t.last,e(n._loadMore).hide()):n._imgCount=t.count,a.checkSelectAllBtn("img"),n.toggleDisable(!1)}))},toggleAddPhotoBtn:function(){var t=e(a._addItem.img);t.hasClass("disable")?t.removeClass("disable"):t.addClass("disable")},preCheckedAll:function(i){i=i||"grid";var n=t("pg-content").getSelectedIds();_.each(t("pg-content")._types,function(t){e(a._item[t]+":visible").each(function(){n.length?e(this).hasClass("checked")?e(this).removeClass("pre-checked"):e(this).addClass("pre-checked"):e(this).removeClass("pre-checked")})})},init:function(e,t,i){t=t||"img",i=i||"grid",_.isEmpty(e)||a.renderContent(e,"append",t,i)},checkItem:function(e){var i=e.data("type");e.toggleClass("checked"),a.preCheckedAll(),t("pg-right").init(),t("pg-top-bar").addTopBar(),a.checkSelectAllBtn(i)},checkSelectAllBtn:function(i){var n=t("pg-content"),r=n.getSelectedIds(i).length,d=n.getLength(i);_.isEqual(r,d)?e(a._parent[i]+" "+a._selectAll).addClass("selected"):e(a._parent[i]+" "+a._selectAll).removeClass("selected")},editItem:function(i){var a=!0;i.hasClass("checked")||(a=!1,i.addClass("checked")),t("pg-editor").init(e("#tm-pg-editor"),_.template(e("#tm-pg-editor-tpl").html()),t("pg-content").getContent(i.data("id")),!0,t("pg-content").getIds("img")),t("pg-content").initScrollbar(5),a||i.removeClass("checked")},renderContent:function(i,n,r,d,l){n=n||"append",r=r||"img",d=d||a.getView();var o="",c=a.getSelector(d,r,"_container");_.each(i,function(e){if(e){var i=_.isUndefined(e.id)?e.ID:e.id;t("pg-content").setContent(i,"",e,r,n),o+=a.addItem(i,r)}}),_.isEqual(n,"append")?e(c).append(o):e(c).prepend(o),_.each(i,function(e){if(e){var t=_.isUndefined(e.id)?e.ID:e.id;a.buildItem(t)}}),!_.isUndefined(l)&&_.isFunction(l)&&l()},addNewItem:function(t,i){t=t||"img",i=i||a.getView();var n=a.addItem(0,t);e(a.getSelector(i,t,"_container")).append(n),e(a.getSelector(i,t,"_item",".new input")).focus()},addItem:function(t,i){i=i||"img";var n=e(a._cloneItem[i]).clone();return e(".tm-pg_library_item",n).attr("data-id",t),n.html()},getItem:function(t){return e('.tm-pg_library_item[data-id="'+t+'"]')},toggleSelectAllBtn:function(i,n){function r(t,i){_.isEqual("hide",i)?e(a._parent[t]+" "+a._selectAll).hide():e(a._parent[t]+" "+a._selectAll).show()}n=n||"hide",_.isUndefined(i)||_.isEmpty(i)?_.each(t("pg-content")._types,function(e){r(e,n)}):r(i,n)},deleteItem:function(e,i){var a={id:e,controller:"media",action:"delete"};t("common").wpAjax(a,function(e){!_.isUndefined(i)&&_.isFunction(i)&&i(e)},function(e){console.warn("Some error!!!"),console.warn(e)})},buildItem:function(i){try{var n=a.getItem(i),r=n.data("type"),d=t("pg-content").getContent(i,r);switch(r){case"img":e(".tm-pg_library_item_loading",n.parents(".tm-pg_column")).addClass("hidden"),e("figure img",n).attr("src",d.thumbnails.big.url),n.removeClass("hidden");break;case"set":case"album":var l=".tm-pg_library_item-content_footer";_.isUndefined(d.cover_img)||_.isEmpty(d.cover_img[r])?(n.addClass("new"),e("figure",n).addClass("hidden")):(n.removeClass("new"),e("figure",n).removeClass("hidden"),e("figure img",n).attr("src",d.cover_img[r][0])),e(l+" .tm-pg_library_item-content_footer_left",n).removeClass("hidden"),e(l+" .tm-pg_library_item-content_footer_right",n).removeClass("hidden"),e(l+" input",n).addClass("hidden"),e(l+" .tm-pg_library_item-name",n).text(d.post.post_title),e(l+' span[data-type="date"]',n).text(d.date),e(l+' span[data-type="count"]',n).text(d.img_count),e(".tm-pg_library_item-content_header",n).removeClass("hidden")}}catch(e){console.warn(e)}}}}var a;return{getInstance:function(){return a||(a=i()),a}}}(jQuery));
Registry.register("image",function(n){"use strict";function e(n){return Registry._get(n)}function o(){return{showUpload:function(){var o=e("grid"),i=e("pg-content"),a=o.getView(),r=n(o._main[a]+" .tm-pg_upload_container");if(!n(o._main[a]+" #plupload-upload-ui").length){var l={};l.nonce=n('[name="nonce"]').val(),i.toggleDisable(),t.uploadImages(l,function(n){o.toggleAddPhotoBtn(),e("upload").loadUploader(n),r.css("height","auto"),i.toggleDisable(!1)})}},uploadImages:function(o,i){var a={controller:"media",action:"uploader"};_.isEqual(e("grid").getView(),"folder")&&(a.folder=e("pg-folder")._ID),n.extend(a,o),e("common").wpAjax(a,function(n){!_.isUndefined(i)&&_.isFunction(i)&&i(n)},function(n){t.uploadError(n),console&&console.warn(n)})}}}var t;return{getInstance:function(){return t||(t=o()),t}}}(jQuery));
Registry.register("set",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{tax_name:window.tm_pg_options.tax_names.set,post_type:window.tm_pg_options.post_types.set,_clone:"#set-term-clone",_item:".tm-pg_set_container",initEvents:function(){var n=e("grid"),o=e("pg-right");t(document).on("focusout",n._item.set+".new input:visible",i.onFocusoutSetInput.bind(this)),t(document).on("keyup",n._item.set+".new input:visible",i.onKeyupSetInput.bind(this)),t(document).on("click",o._slidebar+" .tm-pg_add-to-set_form > button.tm-pg_btn",i.onClickAddToSet.bind(this)),t(document).on("click",o._slidebar+" "+i._item+" .tm-pg_set-delete",i.onClickDeleteFromSet.bind(this))},onClickDeleteFromSet:function(n){var o=e("pg-right").ids,r=t(n.currentTarget).parent(),a=r.data("id"),d=0;i.setAction(o,a,d,"delete_from_folder")},onClickAddToSet:function(n){n.preventDefault();var o=e("pg-right").ids,r=t(n.currentTarget).parent(),a=t("select",r).val(),d=0;i.setAction(o,a,d,"add_to_folder")},onFocusoutSetInput:function(e){e.preventDefault();var n=t(e.currentTarget);_.isEmpty(n.val())&&n.val("Set name"),i.addSet(n)},onKeyupSetInput:function(e){if(e.preventDefault(),13===e.keyCode)return t(e.currentTarget).blur(),!1},setAction:function(t,n,o,r){var a={},d=t[o];n&&(a.value=d,a.id=n,a.controller="folder",a.action=r,e("pg-right").toggleDisable(!0),e("common").wpAjax(a,function(){_.isEqual(r,"delete_from_folder")?i.removeRightCallback(t,o,n):i.addRightCallback(t,o,n,function(){var t=e("notification"),i=t.getLangData(n);t.show("added_to_"+i.type,i.replase),e("pg-folder").updateFolder(n,"set")}),_.isUndefined(t[++o])||i.setAction(t,n,o,r)}))},addRightCallback:function(t,n,i,o){var r=t[n],a=e("pg-content").getContent(r).sets,d=a.indexOf(i);_.isEqual(-1,d)&&a.push(Number(i)),_.isEqual(n,t.length-1)&&(_.isEqual(-1,d)&&e("folder").addRightFolder(i,"set"),!_.isUndefined(o)&&_.isFunction(o)&&o(),e("pg-right").toggleDisable(!1))},removeRightCallback:function(t,n,i){var o=t[n],r=e("notification"),a=e("pg-folder"),d=r.getLangData(i),l=e("pg-content").getContent(o).sets,s=l.indexOf(i);_.isEqual(-1,s)||l.splice(s,1),_.isEqual(n,t.length-1)&&(_.isEqual(-1,s)||e("folder").removeRightFolder(i,"set"),r.show("delete_from_"+d.type,d.replase),a._ID&&a.removeContent(t,i),a.updateFolder(i,"set"),e("pg-right").toggleDisable(!1))},addSet:function(t,n){var o={},r=e("grid"),a=e("folder"),d=t.parents(".tm-pg_library_item");o.type=i.post_type,o.title=t.val(),t.remove(),a.addFolder(o,function(t){d.attr("data-id",t.id),e("pg-content").setContent(t.id,"",t.folder,"set"),r.buildItem(t.id),a.renderRightSelect("set"),!_.isUndefined(n)&&_.isFunction(n)&&n(t),r.toggleSelectAllBtn("set","show"),e("notification").show("add_set",{name:o.title})})}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("tag",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{_clone:"#tag-clone",_item:".tm-pg_tag_container",init:function(){var n,i="",r=e("pg-right")._slidebar;t(r).on("click",".tm-pg_add-tags_form > button.tm-pg_btn",function(n){n.preventDefault();var i=t(this).parent(),r=e("pg-right").ids,s=0;a.tagAction(r,t("input",i).val(),s,"add_term"),t("input",i).val("")}),t(r).on("keyup",".tm-pg_add-tags_form > input",function(e){if(13===e.keyCode)return t("button.tm-pg_btn",t(this).parent()).trigger("click"),!1;clearTimeout(n);var r=t(this);n=setTimeout(function(){return!_.isEmpty(r.val())&&void a.searchTag({q:r.val()},function(e){var n=t("#terms-seach").children().clone();return r.parent().append(n),t('.search-res ul.ac_results li:not(".hidden")').remove(),!_.isEmpty(e)&&(t.each(e,function(t,e){a.buildSearchTags(e,r.val())}),t(".search-res").removeClass("hidden"),void t(".search-res ul.ac_results li").on("click",function(){var e=r.val().split(","),n=r.val();i=t(".tag-name",t(this)).text(),n=n.replace(_.last(e),i),r.val(n).focus(),i="",t(".search-res").addClass("hidden"),t('.search-res ul.ac_results li:not(".hidden")').remove()}))})},1e3)}),t(r).on("click",a._item+" .tm-pg_tag-delete",function(){var n=t(this).parent(),i=e("pg-right").ids,r=0;a.tagAction(i,n.data("id"),r,"delete_term")})},tagAction:function(n,i,r,s){var c,o={};i&&(o.value=i,o.id=n[r],o.action=s,o.type=tm_pg_options.tax_names.tag,_.isEqual(s,"delete_term")?(o.field="term_taxonomy_id",c=t(a._item+'[data-id="'+i+'"] span').text()):(o.field="name",c=i),e("pg-right").toggleDisable(!0),e("term").termAction(o,function(t){a.callback(t,n,r,s,c),_.isUndefined(n[++r])||a.tagAction(n,i,r,s)}))},callback:function(n,i,r,s,c){var o={},l=i[r];_.each(n,function(t){o=t,e("pg-content").setContent(l,"tags",t)}),_.isEqual(r,i.length-1)&&(t(e("pg-right")._slidebar+" "+a._item).remove(),i.length>1&&i.length<10?e("term").addMultiTerms("tags"):a.addTags(o),e("pg-right").toggleDisable(!1),_.isEqual(s,"delete_term")?e("notification").show("delete_tag",{name:c}):e("notification").show("add_tag",{name:c}))},searchTag:function(n,a){var i={controller:"term",action:"search_term",tax:"post_tag"};t.extend(i,n),e("common").wpAjax(i,function(t){!_.isUndefined(a)&&_.isFunction(a)&&a(t,n)},function(t){console.warn("Some error!!!"),console.warn(t)})},addTags:function(n){return!_.isEmpty(n)&&void _.each(n,function(n){var i=t(a._clone).clone();i.children().attr("data-id",n.term_id),t("span.name",i).text(n.name),t(e("pg-right")._slidebar+" .tm-pg_sidebar_image-tags").append(i.children())})},buildSearchTags:function(e,n){var a=t(t(".search-res ul.ac_results li.hidden")[0]).clone();a.removeClass("hidden");var i=e.name.indexOf(n),r=i+n.length;a.attr("data-id",e.term_id),t(".tag-name",a).text(e.name),t(".count",a).text(e.count),0===i?(t(".ac_match",a).text(e.name.substring(i,r)),t(".after",a).text(e.name.substring(r))):(t(".ac_match",a).text(e.name.substring(i,r)),t(".before",a).text(e.name.substring(0,i)),t(".after",a).text(e.name.substring(r))),t(".search-res ul.ac_results").append(a)}}}var a;return{getInstance:function(){return a||(a=n()),a}}}(jQuery));
Registry.register("term",function(t){"use strict";function n(t){return Registry._get(t)}function e(){return{addMultiTerms:function(e){var i=[],r="term_id",o=n("pg-right").ids;switch(_.each(o,function(t){var r=n("pg-content").getContent(t)[e];_.isEmpty(r)||_.each(r,function(t){var n=i.indexOf(t);_.isEqual(-1,n)&&i.push(t)})}),t.each(i,function(t,c){var a=0;_.each(o,function(t){var i=n("pg-content").getContent(t)[e];_.isEmpty(i)||_.each(i,function(t){_.isEmpty(c)||_.isEmpty(t)||c[r]===t[r]&&a++})}),_.isEqual(a,o.length)||(i=_.without(i,c))}),_.isEmpty(i)||(Array.prototype.getUnique=function(){for(var t={},n=[],e=0,i=this.length;e<i;++e)t.hasOwnProperty(this[e])||(n.push(this[e]),t[this[e]]=1);return n},i=i.getUnique()),e){case"tags":n("tag").addTags(i);break;case"categories":n("category").selectCats(i)}},termAction:function(e,i){var r={controller:"term",action:e.action};t.extend(r,e),n("common").wpAjax(r,function(t){!_.isUndefined(i)&&_.isFunction(i)&&i(t)},function(t){console.warn("Some error!!!"),console.warn(t),n("pg-content").toggleDisable(!1),n("pg-right").toggleDisable(!1),n("notification").show("error")})}}}var i;return{getInstance:function(){return i||(i=e()),i}}}(jQuery));