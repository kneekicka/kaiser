window.Registry=function(){"use strict";function e(e){return!(!e.getInstance||"function"!=typeof e.getInstance)}function n(n,t){if(!e(t))throw new Error('Invalide module "'+n+'". The function "getInstance" is not defined.');c[n]=t}function t(n){for(var t in n)if(n.hasOwnProperty(t)){if(!e(n[t]))throw new Error('Invalide module "'+t+'" inside the collection. The function "getInstance" is not defined.');c[t]=n[t]}}function r(e){delete c[e]}function i(e){var n=c[e];if(!n)throw new Error('The module "'+e+'" has not been registered or it was unregistered.');if("function"!=typeof n.getInstance)throw new Error('The module "'+e+'" can not be instantiated. The function "getInstance" is not defined.');return c[e].getInstance()}function o(){return f}function u(e){return f=e}var c={},f="grid";return{register:n,unregister:r,_get:i,registryMap:t,getMode:o,setMode:u}}();
Registry.register("accordion",function(n){"use strict";function t(){return{init:function(){n(".accordion").each(function(){s.accordion(n(this))})},accordion:function(t){t.settings=s.populateOptions(t),s.hideAccordionContent(t),n("."+t.settings.triggerClass+" a",t).on("click.accordion",s.onClick.bind(this,t))},onClick:function(t,s){s.preventDefault(),n("."+t.settings.contentClass,t).slideToggle(),n("."+t.settings.contentClass,t).toggleClass(t.settings.contentOpenClass),n(s.currentTarget).toggleClass(t.settings.openClass)},hideAccordionContent:function(t){n("."+t.settings.triggerClass+" a",t).each(function(){var s=n(this),e=n("."+t.settings.contentClass,t);s.hasClass(t.settings.openClass)?e.addClass(t.settings.contentOpenClass).slideDown():e.removeClass(t.settings.contentOpenClass).slideUp()})},populateOptions:function(n){return{contentClass:n.data("accordion-content-class")||"accordion-content",contentOpenClass:n.data("accordion-content-open-class")||"content-open",openClass:n.data("accordion-open-class")||"open",speed:n.data("accordion-speed")||300,triggerClass:n.data("accordion-trigger-class")||"accordion-trigger"}}}}var s;return{getInstance:function(){return s||(s=t()),s}}}(jQuery));
Registry.register("common",function(n){"use strict";function e(){return{nonceAjax:!1,prependArr:function(n,e){var t=e.slice(0);return t.unshift(n),t},getPage:function(){return!_.isUndefined(t.parseRequest().page)&&t.parseRequest().page},parseRequest:function(e){var t,o=location.search,i={};return _.isEmpty(o)||"?"===o?i:(o=o.replace("?",""),t=o.split("&"),n.each(t,function(){var n=this;n=n.split("="),i[n[0]]=n[1]}),_.isUndefined(e)?i:i[e])},loadFolders:function(e,o){var i={controller:"folder"};n.extend(i,e),t.wpAjax(i,function(n){!_.isUndefined(o)&&_.isFunction(o)&&o(n)},function(n){console&&console.warn(n)})},loadImages:function(e,o){var i={controller:"media",action:"content",count:0,step:40};n.extend(i,e),t.wpAjax(i,function(n){!_.isUndefined(o)&&_.isFunction(o)&&o(n)},function(n){console&&console.warn(n)})},wpAjax:function(n,e,t){var o=!0,i=window.tm_pg_options.action;n[i]=n.action,n.tm_pg_nonce=window.tm_pg_options.nonce,o&&wp.ajax.send("tm_pg",{success:function(n){e(n)},error:function(n){!_.isUndefined(t)&&_.isFunction(t)?t(n):console&&console.warn(n)},data:n})}}}var t;return{getInstance:function(){return t||(t=e()),t}}}(jQuery));
!function(t){"use strict";t(document).on("ready",function(){function e(t){return Registry._get(t)}var n=e("common").getPage();if(n)switch(n){case"tm_pg_media":e("pg-content").init();break;case"gallery":e("gl-content").init()}t(".tm-pg_page-title div").remove()})}(jQuery);
Registry.register("notification",function(t){"use strict";function n(t){return Registry._get(t)}function e(){return{callback:null,_popup:{main:"#popup-dialog-wraper",title:".tm-pg_library_popup-dialog-title",content:".tm-pg_library_popup-dialog-content"},init:function(){t(i._popup.main).on("click.notification",i._popup.content+" a.tm-pg_btn-primary",i.onClickYes.bind(this)),t(i._popup.main).on("click.notification",i._popup.title+" a",i.onClickClose.bind(this)),t(i._popup.main).on("click.notification",i._popup.content+" a.tm-pg_btn-default",i.onClickClose.bind(this))},onClickClose:function(n){n.preventDefault(),t(i._popup.main).hide()},onClickYes:function(n){n.preventDefault(),t(i._popup.main).hide(),i.callback&&_.isFunction(i.callback)&&i.callback()},show:function(t,n){noty({theme:"tm-pg-noty-theme",timeout:5e3,text:i.getText(t,n),layout:"tmPgTopRight",animation:{open:"animated bounceInRight",close:"animated bounceOutRight",easing:"swing",speed:500}})},getLangData:function(t,e){e=e||n("pg-content").getSelectedIds();var i,o="all";return _.isUndefined(t)&&_.isEqual(e.length,1)&&(t=e[0]),_.isUndefined(t)||(o=n("pg-content").getType(t),i=_.isEqual(o,"img")?{name:n("pg-content").getContent(t,o).filename}:{name:n("pg-content").getContent(t,o).post.post_title}),{replase:i,type:o}},getText:function(n,e){var i=tm_pg_admin_lang[n]||"";return _.isEmpty(i)||_.isUndefined(e)||!_.isObject(e)||t.each(e,function(t,n){i=i.replace("%"+t+"%",n)}),i},showDialog:function(n,e,o){var p=i.getText(n,e);t(i._popup.main+" h5").text(p),t(i._popup.main).show(),i.callback=o}}}var i;return{getInstance:function(){return i||(i=e()),i}}}(jQuery));
Registry.register("upload",function(e){"use strict";function r(e){return Registry._get(e)}function o(){return{pluopload:!1,uploader_init:function(){var o,a;this.pluopload||(d||"flash"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty("send_binary_string")||(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0),plupload.addFileFilter("mime_types",function(o,t,a){var d=r("grid").getView(),n=t.name.slice((Math.max(0,t.name.lastIndexOf("."))||1/0)+1),i=this;(_.isUndefined(o)||_.isEmpty(o))&&(o=e(r("grid")._main[d]+" #plupload-browse-button").attr("accept").replace(/\./g,"").split(",")),e.inArray(n.toLowerCase(),o)!==-1?a(!0):(i.trigger("Error",{code:plupload.FILE_EXTENSION_ERROR,message:uploader.errorMap.FILE_EXTENSION_ERROR(t),file:t}),a(!1))}),wpUploaderInit.drop_element=document.body,wpUploaderInit.dropzone=document.body,wpUploaderInit.container=document.body,uploader=new plupload.Uploader(wpUploaderInit),uploader.bind("Init",function(r){var o,t,a=r.features.dragdrop,d=e("body");return setResize(getUserSetting("upload_resize",!1)),"html4"===r.runtime&&e(".upload-flash-bypass").hide(),d.toggleClass("supports-drag-drop",!!a),a?(d.bind("dragover.wp-uploader",function(){o&&clearTimeout(o),t||(d.trigger("dropzone:enter").addClass("drag-over"),t=!0)}),void e(".uploader-window").bind("dragleave.wp-uploader, drop.wp-uploader",function(){o=setTimeout(function(){t=!1,d.trigger("dropzone:leave").removeClass("drag-over")},0)})):d.unbind(".wp-uploader")}),uploader.init(),uploader.bind("FilesAdded",function(o,t){e("body").unbind("dragleave.wp-uploader"),e("body").removeClass("drag-over");var a=e("p.no-media"),d="",n=r("grid"),i=t.length,l=n.getView();for(a[0]&&a.remove(),e("#media-upload-error").empty(),uploadStart();i--;)d+=n.addItem(t[i].id);e(n.getSelector(l,"img","_addItem")).parents(".tm-pg_column").after(d),o.refresh(),o.start()}),uploader.bind("UploadFile",function(e,r){fileUploading(e,r)}),uploader.bind("UploadProgress",function(e,r){t.uploadProgress(e,r)}),uploader.bind("FileUploaded",function(e,r,o){try{o=JSON.parse(o.response)}catch(e){return t.uploadError(pluploadL10n.default_error,e,r)}return!_.isObject(o)||_.isUndefined(o.success)?t.uploadError(pluploadL10n.default_error,null,r):o.success?void t.fileUploaded(r,o):t.uploadError(o.data.message,o.data,r)}),uploader.bind("Error",function(e,r){for(o in uploader.errorMap)if(r.code===plupload[o]){a=uploader.errorMap[o],_.isFunction(a)&&(a=a(r.file,r));break}t.uploadError(a,r,r.file),e.refresh()}),uploader.bind("UploadComplete",function(e,r){uploader.unbindAll(),t.uploadComplete()}),uploader.errorMap={FAILED:pluploadL10n.upload_failed,IMAGE_FORMAT_ERROR:pluploadL10n.not_an_image,IMAGE_MEMORY_ERROR:pluploadL10n.image_memory_exceeded,IMAGE_DIMENSIONS_ERROR:pluploadL10n.image_dimensions_exceeded,GENERIC_ERROR:pluploadL10n.upload_failed,IO_ERROR:pluploadL10n.io_error,HTTP_ERROR:pluploadL10n.http_error,SECURITY_ERROR:pluploadL10n.security_error,FILE_EXTENSION_ERROR:function(e){return tm_pg_admin_lang.FILE_EXTENSION_ERROR.replace("%filename%",e.name)},FILE_SIZE_ERROR:function(e){var r=tm_pg_admin_lang.FILE_SIZE_ERROR.replace("%filename%",e.name).replace("%size%",t.formatSizeUnits(parseInt(uploader.settings.filters.max_file_size)));return r}},this.pluopload=!0)},initCloseButton:function(o){e(r("grid")._main[o]+" button.close").on("click",function(){t.closeUploader(o)})},closeUploader:function(o){o=o||r("grid").getView();var t=e(r("grid")._main[o]+" button.close").attr("parent");r("grid").toggleAddPhotoBtn(),t&&e("#"+t).remove(),this.pluopload=!1},loadUploader:function(o){var a=r("grid").getView();e(r("grid")._main[a]+" .tm-pg_upload_container").html(o.html),t.initCloseButton(a),t.uploader_init()},formatSizeUnits:function(e){for(var r=["B","KB","MB","GB","TB"],o=r.length-1,t=0,a=1024;e>a&&t<o;t++)e/=a;return e},uploadComplete:function(){var e=r("pg-folder"),o=r("grid");a=[],t.closeUploader(),r("notification").show("upload_complite"),e._ID?(e.updateFolder(),e.getLength("img")&&o.toggleSelectAllBtn("img","show")):r("pg-content").getLength("img")&&o.toggleSelectAllBtn("img","show")},uploadProgress:function(o,t){var a=r("grid").getItem(t.id,"img").parent(".tm-pg_column");e(".tm-pg_library_item_loading_container > span",a).text(t.percent+"%"),e(".tm-pg_library_item_loading_bar",a).css("width",t.percent+"%")},fileUploaded:function(e,o){if(o.success){var d=r("grid"),n=r("pg-folder");d.getItem(e.id,"img").attr("data-id",o.data.id),r("pg-content").setContent(o.data.id,"",o.data,"img","prepend"),d.buildItem(o.data.id),d.checkItem(d.getItem(o.data.id,"img")),n._ID&&n.setContent(o.data.id,o.data,"img","prepend"),a.push(o.data.id)}else t.uploadError(e,o.data)},uploadError:function(e,o,t){r("notification").show("error")}}}var t,a=[],d=navigator.userAgent.indexOf("Trident/")!==-1||navigator.userAgent.indexOf("MSIE ")!==-1;return{getInstance:function(){return t||(t=o()),t}}}(jQuery));
Registry.register("gl-editor",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{_scrollCotainer:".tm-pg-scroll-cotainer:visible",_types:["content","display","filters","pagination"],_section:{content:'#wp-gallery-editor div[data-view="content"]',display:'#wp-gallery-editor div[data-view="display"]',filters:'#wp-gallery-editor div[data-view="filters"]',pagination:'#wp-gallery-editor div[data-view="pagination"]'},_container:"#wp-gallery-editor",_preloader:".tm-pg_library_loading",_first:!0,_loaded:!1,_gallery:{},_content:{img:{},album:{},set:{}},_childs:{img:[],album:[],set:[]},_lastRequest:!1,_imgCount:0,toggleDisable:function(e){_.isUndefined(e)&&(e=!0),e?t(i._container).addClass("tm-pg_disable"):t(i._container).removeClass("tm-pg_disable")},initScrollbar:function(){setTimeout(function(){var e=t(i._scrollCotainer).offset().top,n=window.innerHeight-e-15;t(i._scrollCotainer).height(n)},500),t(i._scrollCotainer).scrollTop(0)},getContent:function(t,e){try{return e=e||i.getType(t),_.isUndefined(t)||_.isUndefined(i._content[e][t])?i._content[e]:i._content[e][t]}catch(t){console&&console.warn(t.message)}},setContent:function(t,e,n,o){o=o||i.getType(t),_.isEmpty(e)?i._content[o][t]=n:i._content[o][t][e]=n},getLength:function(t){return Object.keys(i._content[t]).length},getType:function(t){var e=!1;return _.each(i._types,function(n){_.isUndefined(i._content[n][t])||(e=n)}),e},init:function(n){var o=e("gl-editor"),l=e("gl-content"),r=e("gl-editor-grid");o.hideSection(),o.showSection("content"),e("gl-editor-top-bar").refreshMenu(),t(r._selectAll).removeClass("selected"),_.isUndefined(n)?n=i._gallery.id:i._childs=t.extend(!0,{},l.getContent(n).childs),i._gallery=e("gl-content").getContent(n),t(".tm-pg_gallery_title h2").text(i._gallery.post.post_title),t(l._container).hide(),t(i._container).show(),i.initScrollbar(),i._first?(i._first=!1,i.loadContent()):(_.each(i._types,function(e){t(r._parent[e]+" .tm-pg_library_title a").removeClass("selected")}),r.selectItems(),e("gl-editor-right").renderItems())},loadContent:function(){var n=e("common"),o=e("gl-editor-grid"),l=e("accordion");i.toggleDisable(!0),n.loadFolders({action:"get_sets"},function(r){i.renderGrid("set",r.posts),_.isNull(r.posts)&&t(o._parent.set).hide(),i.getLength("set")&&o.toggleSelectAllBtn("set","show"),o.showGrid("set"),l.accordion(t(o._parent.set+" .accordion")),n.loadFolders({action:"get_albums"},function(r){i.renderGrid("album",r.posts),_.isNull(r.posts)&&t(o._parent.album).hide(),i.getLength("album")&&o.toggleSelectAllBtn("album","show"),o.showGrid("album"),l.accordion(t(o._parent.album+" .accordion")),n.loadImages({},function(n){n.posts&&i.renderGrid("img",n.posts),n.last?(i._lastRequest=n.last,t(".tm-pg-load-more").hide()):n.count&&(_.isEqual(n.images_count,n.count)?(i._lastRequest=!0,t(".tm-pg-load-more").hide()):t(".tm-pg-load-more").show(),i._imgCount=n.count),i.getLength("img")&&o.toggleSelectAllBtn("img","show"),i.getLength("img")||t(o._parent.album).hide(),i._loaded=!0,l.accordion(t(o._parent.img+" .accordion")),o.showGrid("img"),e("gl-editor-right").renderItems(),i.toggleDisable(!1)})})})},initEvents:function(){t(document).on("click",".tm-pg_back-btn a",i.onClickBack.bind(this)),t(document).on("click",".tm-pg_gallery_save a",i.onClickSave.bind(this))},onClickSave:function(t){t.preventDefault(),i.saveGallery(function(t){e("gl-content").setContent(t.id,"",t),e("grid").renderContent(e("gl-content")._content.public),i.showList()})},onClickBack:function(t){t.preventDefault(),i.showList()},showList:function(){e("gl-editor-grid").unCheckedAll(),e("gl-editor-display")._content={},t(i._container).hide(),t(e("gl-content")._container).show(),e("grid").initAjax()},saveGallery:function(t){i._gallery.childs=i._childs,i._gallery.grid=e("gl-editor-display")._content,i._gallery.filter=e("gl-editor-filters")._content,i._gallery.pagination=e("gl-editor-pagination")._content;var n={id:i._gallery.id,controller:"gallery",action:"save",content:i._childs,grid:i._gallery.grid,filter:i._gallery.filter,pagination:i._gallery.pagination},o=e("gl-content"),l=e("notification"),r=e("common");o.toggleDisable(),r.wpAjax(n,function(e){!_.isUndefined(t)&&_.isFunction(t)&&t(e),o.toggleDisable(!1),l.show("save_gallery",{name:i._gallery.post.post_title})},function(t){console&&console.warn(t),o.toggleDisable(!1),l.show("error")})},renderGrid:function(t,n){n=n||i._content[t],e("gl-editor-grid").init(n,t)},showSection:function(e){t(i._section[e]).show()},hideSection:function(e){_.isUndefined(e)?_.each(i._types,function(e){t(i._section[e]).hide()}):t(i._section[e]).hide()}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("gl-editor-display",function(t){"use strict";function i(t){return Registry._get(t)}function e(){return{_rightScrollContainer:"#tm-pg-sidebar-scroll-container",_item:".tm-pg_gallery_display-type_item",_right:"#sidebar-content",_content:{},init:function(){t(n._item+" a").removeClass("active"),i("gl-editor").hideSection(),i("gl-editor").showSection("display"),n.initRightScrollbar(),_.isEmpty(n._content)&&(n._content=t.extend(!0,{},i("gl-editor")._gallery.grid)),t(n._item+" a.tm-pg_gallery_display-type_"+n._content.type).addClass("active"),n.initGrid(),n.initRight()},initGrid:function(){t(document).on("click",n._item+" a",n.onClickDisplayGrid.bind(this)),t(document).on("change",n._right+' div[data-type="colums"] select',n.onChangeColums.bind(this))},onChangeColums:function(i){n._content.colums=t(i.currentTarget).val()},onClickDisplayGrid:function(i){i.preventDefault(),t(n._item+" a").removeClass("active"),t(i.currentTarget).addClass("active"),n._content.type=t(i.currentTarget).data("type"),n.initRight()},initRight:function(){var i=n._right+' div[data-type="colums"]';t(i+" .select2").val(n._content.colums),_.isEqual(n._content.type,"justify")?t(i).hide():(t(i+" .select2").select2(),t(i).show())},initRightScrollbar:function(){var i=innerHeight-t(n._rightScrollContainer).offset().top-30;t(n._rightScrollContainer).height(i)}}}var n;return{getInstance:function(){return n||(n=e()),n}}}(jQuery));
Registry.register("gl-editor-filters",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{_item:".tm-pg_gallery_filters_item",_content:{},init:function(){var n=e("gl-editor");n.hideSection(),n.showSection("filters"),_.isEmpty(i._content)&&(i._content=t.extend(!0,{},n._gallery.filter)),i.initContent()},initContent:function(){t(i._item+'[data-type="show"] #show-filter').prop("checked",i._content.show),t(i._item+'[data-type="type"] .select2').val(i._content.type),t(i._item+'[data-type="by"] .select2').val(i._content.by),t(i._item+" .select2").select2()},initEvents:function(){t(document).on("change",i._item+" input",i.onChangeInput.bind(this)),t(document).on("change",i._item+" select",i.onChangeSelect.bind(this))},onChangeInput:function(e){var n=t(e.currentTarget).parents(i._item).data("type");i._content[n]=t(e.currentTarget).is(":checked")?1:0},onChangeSelect:function(e){var n=t(e.currentTarget).parents(i._item).data("type");i._content[n]=t(e.currentTarget).val()}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("gl-editor-grid",function(e){"use strict";function t(e){return Registry._get(e)}function i(){return{_container:{img:'div[data-id="photos"] .tm-pg_library_photos',album:'div[data-id="albums"] .tm-pg_library_albums',set:'div[data-id="sets"] .tm-pg_library_sets'},_parent:{img:'div[data-id="photos"]',album:'div[data-id="albums"]',set:'div[data-id="sets"]'},_cloneItem:{img:"#image-clone",album:"#album-clone",set:"#set-clone"},_item:{img:'div[data-id="photos"] .tm-pg_library_item',album:'div[data-id="albums"] .tm-pg_library_item',set:'div[data-id="sets"] .tm-pg_library_item'},_addItem:{img:'div[data-id="photos"] .tm-pg_library_item_add',album:'div[data-id="albums"] .tm-pg_library_item_add',set:'div[data-id="sets"] .tm-pg_library_item_add'},_types:["img","album","set"],_selectAll:".tm-pg_library_grid_header_select_all",init:function(e,t){n.renderContent(e,t)},initAjax:function(t){t=t||"img",e(document).on("click",n._item[t],n.onClickItem.bind(this,t)),e(document).on("click",n._parent[t]+" "+n._selectAll,n.onClickSelectAll.bind(this,t)),e(document).on("click",n._parent[t]+" .tm-pg-load-more",n.onClickShowMore.bind(this))},onClickShowMore:function(i){i.preventDefault();var a=t("gl-editor");a.toggleDisable(!0),t("common").loadImages({count:a._imgCount},function(i){i.posts&&a.renderGrid("img",i.posts),n.showGrid("img"),t("gl-editor-right").renderItems(),i.last?(a._lastRequest=i.last,e(".tm-pg-load-more").hide()):a._imgCount=i.count,n.checkSelectAllBtn("img"),a.toggleDisable(!1)})},onClickSelectAll:function(i,a){a.preventDefault();var d=e(a.currentTarget);d.toggleClass("selected"),d.hasClass("selected")?e(n._item[i]).addClass("checked"):e(n._item[i]).removeClass("checked"),e(n._item[i]).each(function(){n.toggleItem(e(this).data("id"),i)}),t("gl-editor-right").renderItems()},onClickItem:function(i,a){a.preventDefault(),e(a.currentTarget).toggleClass("checked");var d=e(a.currentTarget).data("id");n.toggleItem(d,i),t("gl-editor-right").renderItems()},toggleItem:function(i,a){var d=t("gl-editor")._childs[a];if(e(n._item[a]+'[data-id="'+i+'"]').hasClass("checked"))_.isEqual(e.inArray(i,d),-1)&&d.push(i);else{var r=d.indexOf(i);d.splice(r,1)}_.each(n._types,function(e){t("gl-editor-right").init(e)}),n.checkSelectAllBtn(a)},checkSelectAllBtn:function(i){var a=n.getSelectedIds(i).length,d=t("gl-editor").getLength(i);_.isEqual(a,d)?e(n._parent[i]+":visible "+n._selectAll).addClass("selected"):e(n._parent[i]+":visible "+n._selectAll).removeClass("selected")},toggleSelectAllBtn:function(t,i){function a(t,i){_.isEqual("hide",i)?e(n._parent[t]+" "+n._selectAll).hide():e(n._parent[t]+" "+n._selectAll).show()}i=i||"hide",_.isUndefined(t)||_.isEmpty(t)?_.each(n._types,function(e){a(e,i)}):a(t,i)},showGrid:function(i){i=i||!1,i?(e(n._container[i]).show(),e(n._parent[i]+" "+t("gl-editor")._preloader).hide(),e(n._addItem[i]).parent().hide(),n.selectItems(i)):_.each(n._types,function(t){e(n._container[t]).show(),e(n._addItem[t]).parent().hide(),n.selectItems(t)})},selectItems:function(i){_.isUndefined(i)?_.each(n._types,function(i){t("gl-editor-right").init(i),e.each(t("gl-editor-right")._content[i],function(e,t){t&&n.getItem(e,i).addClass("checked")})}):(t("gl-editor-right").init(i),e.each(t("gl-editor-right")._content[i],function(e,t){t&&n.getItem(e,i).addClass("checked")}))},renderContent:function(i,a,d){a=a||"img";var r="",l=n._container[a];_.each(i,function(e){if(e){var i=_.isUndefined(e.id)?e.ID:e.id;t("gl-editor").setContent(i,"",e,a),r+=n.addItem(i,a)}}),e(l).append(r),_.each(i,function(e){if(e){var t=_.isUndefined(e.id)?e.ID:e.id;n.buildItem(t,a)}}),!_.isUndefined(d)&&_.isFunction(d)&&d()},getItem:function(i,a){return a=a||t("gl-editor").getType(i),e(n._item[a]+'[data-id="'+i+'"]')},getSelectedIds:function(t){var i=[];t=t||"img";var a=e(n._item[t]+".checked");return e.each(a,function(t,n){i[t]=e(n).data("id")}),i},getAllSelectedIds:function(){var e={};return _.each(n._types,function(t){e[t]=n.getSelectedIds(t)}),e},buildItem:function(i,a){try{a=a||t("gl-editor").getType(i);var d=t("gl-editor").getContent(i,a),r=n.getItem(i,a);switch(a){case"img":e(".tm-pg_library_item_loading",r.parents(".tm-pg_column")).addClass("hidden"),e("figure img",r).attr("src",d.thumbnails.big.url),e(".tm-pg_library_item-zoom",r).hide(),r.removeClass("hidden");break;case"set":case"album":var l=".tm-pg_library_item-content_footer";_.isUndefined(d.cover_img)||_.isEmpty(d.cover_img[a])||(r.removeClass("new"),e("figure",r).removeClass("hidden"),e("figure img",r).attr("src",d.cover_img[a][0])),e(l+" .tm-pg_library_item-content_footer_left",r).removeClass("hidden"),e(l+" input",r).addClass("hidden"),e(l+" .tm-pg_library_item-name",r).text(d.post.post_title),e(l+' span[data-type="date"]',r).text(d.date),e(l+' span[data-type="count"]',r).text(d.img_count),e(".tm-pg_library_item-content_header",r).removeClass("hidden")}}catch(e){console.warm(e)}},unCheckedAll:function(){_.each(n._types,function(t){e(n._item[t]).each(function(){e(this).removeClass("checked")})})},addItem:function(t,i){i=i||"img";var a=e(n._cloneItem[i]).clone();return e(".tm-pg_library_item",a).attr("data-id",t),a.html()}}}var n;return{getInstance:function(){return n||(n=i()),n}}}(jQuery));
Registry.register("gl-editor-pagination",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{_item:".tm-pg_gallery_pagination_item",_content:{},init:function(){e("gl-editor").hideSection(),e("gl-editor").showSection("pagination"),_.isEmpty(i._content)&&(i._content=t.extend(!0,{},e("gl-editor")._gallery.pagination)),i.initContent()},initContent:function(){t(i._item+'[data-type="show"] input').prop("checked",i._content.show),t(i._item+'[data-type="images_per_page"] .select2').val(i._content.images_per_page),t(i._item+'[data-type="load_more_btn"] input').prop("checked",i._content.load_more_btn),t(i._item+'[data-type="load_more_grid"] input').prop("checked",i._content.load_more_grid),t(i._item+'[data-type="pagination_block"] input').prop("checked",i._content.pagination_block),t(i._item+" .select2").select2()},initEvents:function(){t(document).on("change",i._item+" input",i.onChangeCheckbox.bind(this)),t(document).on("change",i._item+" select",i.onChangeSelect.bind(this))},onChangeSelect:function(e){var n=t(e.currentTarget).parents(i._item).data("type");i._content[n]=t(e.currentTarget).val()},onChangeCheckbox:function(e){var n=t(e.currentTarget).parents(i._item).data("type");t(e.currentTarget).is(":checked")?i._content[n]=1:i._content[n]=0}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("gl-editor-right",function(e){"use strict";function t(e){return Registry._get(e)}function i(){return{_clone:"#right-grid",_container:".tm-pg_sidebar_chosen-items",_item:".tm-pg_sidebar_chosen-items .tm-pg_sidebar_chosen-item",_header:".tm-pg_sidebar_chosen-items_header",_delete:".tm-pg_sidebar_chosen-items_delete",_deleteAll:".tm-pg_sidebar_chosen-items_remove-all",_content:{img:{},album:{},set:{}},init:function(i){n._content[i]={},_.isNull(t("gl-editor")._childs)||e.each(t("gl-editor")._content[i],function(e,r){_.each(t("gl-editor")._childs[i],function(t){_.isEqual(Number(e),Number(t))&&(n._content[i][t]=r)})})},initGrid:function(){n.initScrollbar(),n.toggleHeader()},initEvents:function(){e(document).on("click",n._item,n.onClickRightItem.bind(this)),e(document).on("click",n._delete,n.onClickDelete.bind(this)),e(document).on("click",n._deleteAll,n.onClickDeleteAll.bind(this))},onClickDeleteAll:function(i){i.preventDefault();var r=t("gl-editor-grid");_.each(e(n._item),function(t){var i=e(t).data("type"),n=e(t).data("id");e(r._item[i]+'[data-id="'+n+'"]').removeClass("checked"),r.toggleItem(n,i)}),t("gl-editor-right").renderItems()},onClickDelete:function(i){i.preventDefault();var r=t("gl-editor-grid");_.each(e(n._item+".checked"),function(t){var i=e(t).data("type"),n=e(t).data("id");e(r._item[i]+'[data-id="'+n+'"]').removeClass("checked"),r.toggleItem(n,i)}),t("gl-editor-right").renderItems()},onClickRightItem:function(t){t.preventDefault(),e(t.currentTarget).toggleClass("checked"),n.toggleHeader()},toggleHeader:function(){e(n._item).hasClass("checked")?(e("h5",n._header).removeClass("hide"),e("h5 span",n._header).text(e(n._item+".checked").length),e(n._delete,n._header).removeClass("hide")):(e("h5",n._header).addClass("hide"),e(n._delete,n._header).addClass("hide"))},initScrollbar:function(){e(n._container).css("height","");var t=innerHeight-e(n._container).offset().top-45;e(n._container).height()>t&&e(n._container).height(t)},renderItems:function(){var i="",r=t("gl-editor")._childs,d=t("gl-editor-grid")._types;_.each(d,function(e){_.each(r[e],function(t){_.isUndefined(n._content[e][t])||(i+=n.addItem(t))})}),e(n._container).html(i),_.each(d,function(t){e.each(n._content[t],function(e,i){i&&n.buildItem(t,e)})}),n.initGrid()},addItem:function(t){var i=e(n._clone).clone();return e(".tm-pg_column",i).attr("data-id",t),i.html()},buildItem:function(t,i){var r=n._content[t][i],d=e(n._item+'[data-id="'+i+'"]');d.attr("data-type",t),_.isEqual(t,"img")?(e("figure img",d).attr("src",r.thumbnails.big.url),e("figure",d).removeClass("hidden")):(_.isNull(r.cover_img.big)||_.isEmpty(r.cover_img.right)?d.addClass("new"):(e("figure",d).removeClass("hidden"),e("figure img",d).attr("src",r.cover_img.big[0])),e('div[data-type="'+t+'"]',d).removeClass("hidden"))}}}var n;return{getInstance:function(){return n||(n=i()),n}}}(jQuery));
Registry.register("gl-editor-top-bar",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{_menu:".tm-pg_gallery_tabs",init:function(){t(document).on("click",i._menu+" a",i.onClickTabs.bind(this))},onClickTabs:function(e){_.each(t(i._menu+" a"),function(e){t(e).removeClass("active")}),t(e.currentTarget).addClass("active"),i.initSection(t(e.currentTarget).data("type"))},refreshMenu:function(){_.each(t(i._menu+" a"),function(e){t(e).removeClass("active")}),t(i._menu+' a[data-type="images"]').addClass("active")},initSection:function(t){t="images"!==t?"-"+t:"",e("gl-editor"+t).init()}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("gl-content",function(t){"use strict";function n(t){return Registry._get(t)}function e(){return{_scrollCotainer:".tm-pg_library-list_gallery",_container:"#wp-gallery-list",_preloader:".tm-pg_library_loading",_types:["public","trash"],_body:"#wpbody-content",_content:{public:{},trash:{}},initScrollbar:function(){setTimeout(function(){var n=t(i._scrollCotainer).offset().top,e=window.innerHeight-n-70;t(i._scrollCotainer).height(e)},500),t(i._scrollCotainer).scrollTop(0)},getContent:function(t,n){try{return n=n||i.getType(t),_.isUndefined(t)||_.isUndefined(i._content[n][t])?i._content[n]:i._content[n][t]}catch(t){console&&console.warn(t.message)}},getLength:function(t){return Object.keys(i._content[t]).length},setContent:function(t,n,e,o){o=o||i.getType(t),_.isEmpty(n)?i._content[o][t]=e:i._content[o][t][n]=e},deleteContent:function(t,n){n=n||i.getType(t),_.isUndefined(i._content[n][t])||delete i._content[n][t]},getType:function(t){var n=!1;return _.each(i._types,function(e){_.isUndefined(i._content[e][t])||(n=e)}),n},toggleDisable:function(n){t(i._body)[n?"addClass":"removeClass"]("tm-pg_disable")},init:function(){i.initScrollbar(),n("gl-editor").initEvents(),n("gl-editor-top-bar").init(),n("gl-editor-right").initEvents(),n("gl-editor-filters").initEvents(),n("gl-editor-pagination").initEvents(),n("gl-editor-display").initGrid(),n("gallery").gridInit(),n("gl-top-bar").initEvents(),n("notification").init(),n("grid").initEvents(),_.each(n("gl-editor-grid")._types,function(t){n("gl-editor-grid").initAjax(t)}),i.loadContent({},function(e){_.each(i._types,function(t){i.renderGrid(e[t].data,t),i.getLength(t)&&n("grid").toggleSelectAllBtn(t,"show")}),i.showGrid(),t(i._preloader).hide(),n("gl-top-bar").addTopBar()})},loadContent:function(e,i){var o={controller:"gallery",action:"content"};t.extend(o,e),n("common").wpAjax(o,function(t){!_.isUndefined(i)&&_.isFunction(i)&&i(t)},function(t){console&&console.warn(t)})},getSelectedIds:function(e){var i=[];e=e||"public";var o=t(n("grid")._item[e]+".checked");return t.each(o,function(n,e){i[n]=t(e).data("id")}),i},renderGrid:function(t,e){e=e||"public",t=t||i._content[e],n("grid").init(t,e)},showGrid:function(e){e=e||"public";var i=_.isEqual(e,"public")?"trash":"public",o=n("grid");t(o._parent[i]).hide(),t(o._container[i]).hide(),t(o._parent[e]).show(),t(o._container[e]).show(),o.initAjax(e)}}}var i;return{getInstance:function(){return i||(i=e()),i}}}(jQuery));
Registry.register("gl-top-bar",function(e){"use strict";function t(e){return Registry._get(e)}function l(){return{_clone:{selected:"#selected-topbar",default:"#default-topbar"},_container:".tm-pg_library-filter",_addContainer:"a.tm-pg_library-filter_add-gallery",_menu:{public:".tm-pg_library-filter_all-galleries",trash:".tm-pg_library-filter_trash"},status:"public",init:function(){e(n._menu.public+" span").text(t("gl-content").getLength("public")),e(n._menu.trash+" span").text(t("gl-content").getLength("trash"))},initEvents:function(){e(document).on("click",n._addContainer,n.onClickAddGallery.bind(this)),e(document).on("click",n._menu.public,n.onClickMenuPublic.bind(this)),e(document).on("click",n._menu.trash,n.onClickMenuThash.bind(this)),e(document).on("click",".tm-pg_library-filter_selected-close",n.onClickClose.bind(this)),e(document).on("click",".tm-pg_library-filter_history_container > a",n.onClickRestore.bind(this)),e(document).on("click",".tm-pg_library-filter_selected-settings_delete > a",n.onClickDelete.bind(this))},onClickMenuThash:function(e){e.preventDefault(),t("gl-content").showGrid("trash"),n.addTopBar("trash"),t("gl-content").getLength("trash")&&t("grid").toggleSelectAllBtn("trash","show")},onClickMenuPublic:function(e){e.preventDefault(),t("gl-content").showGrid("public"),n.addTopBar("public"),t("gl-content").getLength("public")&&t("grid").toggleSelectAllBtn("public","show")},onClickAddGallery:function(e){e.preventDefault(),t("grid").addNewItem()},onClickDelete:function(e){e.preventDefault();var l=t("gl-content").getSelectedIds(n.status),i="trash";_.isEqual(n.status,"trash")?(i="delete",t("notification").showDialog("delete_gallery_dialog","",function(){t("gallery").deleteGallery(l,i,function(){n.unselectAll(n.status)})})):t("gallery").deleteGallery(l,i,function(){t("grid").renderContent(t("gl-content")._content.trash,"trash"),n.unselectAll(n.status)})},onClickRestore:function(e){e.preventDefault();var l=t("gl-content").getSelectedIds(n.status);t("gallery").deleteGallery(l,"public",function(){t("grid").renderContent(t("gl-content")._content.public,"public"),n.unselectAll(n.status)})},onClickClose:function(e){e.preventDefault(),n.unselectAll(n.status)},unselectAll:function(l){l=l||"public";var i=t("gl-content").getSelectedIds(l);_.each(i,function(e){t("grid").getItem(e,l).toggleClass("checked")}),e(t("grid")._parent[l]+" .tm-pg_library_title a").removeClass("selected"),n.buildTopBar(l)},addTopBar:function(e){e=e||"public",n.status=e;var l=t("gl-content").getSelectedIds(e);l.length>0?n.buildSelectedTopBar(l,e):n.buildTopBar(e)},buildTopBar:function(t){t=t||"public";var l=e(n._clone.default).clone();_.isEqual(t,"trash")&&e(".tm-pg_library-filter_add-gallery",l).parent().hide(),e(n._container).hasClass("tm-pg_library-filter_selected")&&e(n._container).addClass("hide-box"),setTimeout(function(){e(n._container).removeClass("tm-pg_library-filter_selected").removeClass("hide-box").html(l.children()),n.init()},500)},buildSelectedTopBar:function(t,l){l=l||"public",e(n._container).addClass("tm-pg_library-filter_selected");var i=e(n._clone.selected).clone();e(".tm-pg_library-filter_selected-title span",i).text(t.length),_.isEqual(l,"trash")&&e(".tm-pg_library-filter_history_container",i).show(),e(n._container).html(i.children())}}}var n;return{getInstance:function(){return n||(n=l()),n}}}(jQuery));
Registry.register("gallery",function(t){"use strict";function e(t){return Registry._get(t)}function n(){return{gridInit:function(){var n=e("grid");t(document).on("focusout",n._item.public+" input",i.onFocusOutInput.bind(this)),t(document).on("keyup",n._item.public+" input",i.onKeyupInput.bind(this))},onKeyupInput:function(e){e.preventDefault(),13===e.keyCode&&t(e.currentTarget).blur()},onFocusOutInput:function(n){n.preventDefault();var o=t(n.currentTarget),l=o.attr("name"),r=e("grid"),a=e("gl-content");switch(l){case"new_gallery":_.isEmpty(o.val())&&o.val("Gallery name"),i.addGallery(o,function(t){a.setContent(t.id,"",t,"public"),r.buildItem(t.id),r.initAjax()});break;case"edit_gallery":i.editGallery(o,function(t){a.setContent(t.id,"",t,"public"),r.buildItem(t.id),r.initAjax()})}},editGallery:function(n,i){var o=n.parents(".tm-pg_library_item"),l={controller:"gallery",action:"edit",title:n.val(),id:o.data("id")},r=e("gl-content"),a=e("notification");r.toggleDisable(),e("common").wpAjax(l,function(e){n.addClass("hidden"),t(".tm-pg_library_item-content_footer_left",o).removeClass("hidden"),t(".tm-pg_library_item-content_footer_right",o).removeClass("hidden"),!_.isUndefined(i)&&_.isFunction(i)&&i(e),r.toggleDisable(!1),a.show("edit_gallery")},function(t){console&&console.warn(t),r.toggleDisable(!1),a.show("error")})},deleteGallery:function(t,n,i){var o={controller:"gallery",action:n,ids:t.join(",")},l=e("gl-content"),r=e("notification"),a=e("grid");l.toggleDisable(),e("common").wpAjax(o,function(e){_.each(t,function(t){a.getItem(t).parent().remove(),l.deleteContent(t);var i=_.isEqual("trash",n)?"public":"trash";_.isEqual(n,"delete")||l.setContent(t,"",e[t],n),l.getLength(i)||a.toggleSelectAllBtn(i)}),!_.isUndefined(i)&&_.isFunction(i)&&i(e),l.toggleDisable(!1),r.show(n+"_gallery")},function(t){console&&console.warn(t),l.toggleDisable(!1),r.show("error")})},addGallery:function(t,n){var i={controller:"gallery",action:"add",title:t.val()},o=e("gl-content"),l=e("notification"),r=t.parents(".tm-pg_library_item");t.remove(),o.toggleDisable(),e("common").wpAjax(i,function(t){r.attr("data-id",t.id),!_.isUndefined(n)&&_.isFunction(n)&&n(t),o.getLength("public")&&e("grid").toggleSelectAllBtn("public","show"),o.toggleDisable(!1),l.show("add_gallery",{name:i.title})},function(t){console&&console.warn(t),o.toggleDisable(!1),l.show("error")})}}}var i;return{getInstance:function(){return i||(i=n()),i}}}(jQuery));
Registry.register("grid",function(t){"use strict";function e(t){return Registry._get(t)}function i(){return{_item:{public:'div[data-id="public"] .tm-pg_library_item',trash:'div[data-id="trash"] .tm-pg_library_item'},_container:{public:'div[data-id="public"] .tm-pg_library_gallery',trash:'div[data-id="trash"] .tm-pg_library_gallery'},_addItem:{public:'div[data-id="public"] .tm-pg_library_item_add > a',trash:'div[data-id="trash"] .tm-pg_library_item_add > a'},_parent:{public:'div[data-id="public"]',trash:'div[data-id="trash"]'},_cloneItem:"#gallery-clone",_selectAll:".tm-pg_library_title a",status:"public",initAjax:function(e){e=e||"public",n.status=e,_.isEqual(e,"trash")&&t(n._addItem[e]).parents(".tm-pg_column").hide()},initEvents:function(){_.each(e("gl-content")._types,function(e){t(document).on("click",n._addItem[e],n.onClickAddNewItem.bind(this)),t(document).on("click",n._item[e],n.onClickItem.bind(this)),t(document).on("click",n._parent[e]+" .tm-pg_library_title a",n.onClickSelectAll.bind(this)),t(document).on("click",n._item[e]+" a.tm-pg_library_item-delete",n.onClickDelete.bind(this)),t(document).on("click",n._item[e]+" a.tm-pg_library_item-rename",n.onClickRename.bind(this)),t(document).on("click",n._item[e]+" a.tm-pg_library_item-check",n.onClickCheker.bind(this)),t(document).on("click",n._item[e]+" a.tm-pg_library_item-link",n.onClickNext.bind(this))})},onClickNext:function(i){i.preventDefault();var a=t(i.currentTarget).parents(n._item[n.status]),l=a.data("id");e("gl-editor").init(l)},onClickCheker:function(i){i.preventDefault();var a=t(i.currentTarget).parents(n._item[n.status]);a.toggleClass("checked"),n.checkSelectAll(n.status),e("gl-top-bar").addTopBar(n.status)},onClickRename:function(e){e.preventDefault();var i=t(e.currentTarget).parents(n._item[n.status]);n.initRename(i,n.status)},onClickDelete:function(i){i.preventDefault();var a="trash",l=t(i.currentTarget).parents(n._item[n.status]);_.isEqual(n.status,"trash")?(a="delete",e("notification").showDialog("delete_gallery_dialog","",function(){e("gallery").deleteGallery([l.data("id")],a,function(){e("gl-top-bar").addTopBar(n.status),n.initAjax(n.status)})})):e("gallery").deleteGallery([l.data("id")],a,function(){_.isEqual(n.status,"public")&&e("grid").renderContent(e("gl-content")._content.trash,"trash"),e("gl-top-bar").addTopBar(n.status),n.initAjax(n.status)})},onClickSelectAll:function(i){i.preventDefault();var a=t(i.currentTarget);a.toggleClass("selected"),t(n._item[n.status]).each(function(){a.hasClass("selected")?t(this).addClass("checked"):t(this).removeClass("checked")}),e("gl-top-bar").addTopBar(n.status)},onClickItem:function(i){i.preventDefault(),t(i.target).hasClass("material-icons")||(t(i.currentTarget).toggleClass("checked"),n.checkSelectAll(n.status),e("gl-top-bar").addTopBar(n.status))},onClickAddNewItem:function(t){t.preventDefault(),n.addNewItem(n.status)},checkSelectAll:function(i){var a=e("gl-content").getSelectedIds(i).length,l=e("gl-content").getLength(i);_.isEqual(a,l)?t(n._parent[i]+":visible "+n._selectAll).addClass("selected"):t(n._parent[i]+":visible "+n._selectAll).removeClass("selected")},initRename:function(i,n){var a=i.data("id"),l=e("gl-content").getContent(a,n).post.post_title;t(".tm-pg_library_item-content_footer_left",i).addClass("hidden"),t(".tm-pg_library_item-content_footer_right",i).addClass("hidden"),t('input[name="edit_gallery"]',i).removeClass("hidden").focus().val(l)},init:function(t,e){n.renderContent(t,e)},renderContent:function(i,a,l){var r="",c=n._container[a];_.isEqual(a,"public")&&(r+=t("#new-gallery-clone").clone().html()),_.each(i,function(t){if(t){var i=t.id;e("gl-content").setContent(i,"",t,a),r+=n.addItem(i,a)}}),t(c).html(r),_.each(i,function(t){if(t){var e=_.isUndefined(t.id)?t.ID:t.id;n.buildItem(e,a)}}),t(n._container[a]).removeClass("hidden"),!_.isUndefined(l)&&_.isFunction(l)&&l()},getItem:function(i,a){return a=a||e("gl-content").getType(i),t(n._item[a]+'[data-id="'+i+'"]')},addItem:function(e){e=e||0;var i=t(n._cloneItem).clone();return t(".tm-pg_library_item",i).attr("data-id",e),i.html()},addNewItem:function(e){e=e||"public";var i=n.addItem();t(n._container[e]).append(i),t(n._item[e]+'.new input[name="new_gallery"]').focus()},toggleSelectAllBtn:function(i,a){function l(e,i){_.isEqual("hide",i)?t(n._parent[e]+" "+n._selectAll).hide():t(n._parent[e]+" "+n._selectAll).show()}a=a||"hide",_.isUndefined(i)||_.isEmpty(i)?_.each(e("gl-content")._types,function(t){l(t,a)}):l(i,a)},buildItem:function(i,a){a=a||"public";try{var l=e("gl-content").getContent(i,a),r=n.getItem(i,a),c=".tm-pg_library_item-content_footer";t(c+" input",r).addClass("hidden"),t(c+" .tm-pg_library_item-content_footer_left",r).removeClass("hidden"),_.isEqual(a,"public")&&t(c+" .tm-pg_library_item-content_footer_right",r).removeClass("hidden"),t(c+" .tm-pg_library_item-name",r).text(l.post.post_title),t(c+' span[data-type="date"]',r).text(l.date),_.isEqual(a,"trash")&&t(".tm-pg_library_item-rename",r).hide(),_.isEmpty(l.childs)||t(c+' span[data-type="count"]',r).text(l.img_count),_.isEmpty(l.cover)?(r.addClass("new"),t("figure",r).addClass("hidden")):(r.removeClass("new"),t("figure",r).removeClass("hidden"),t("figure img",r).attr("src",l.cover[0]))}catch(t){console.warn(t)}}}}var n;return{getInstance:function(){return n||(n=i()),n}}}(jQuery));